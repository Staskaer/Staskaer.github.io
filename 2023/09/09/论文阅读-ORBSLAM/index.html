<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/imgs/theme_pic/staskaer.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/imgs/theme_pic/staskaer.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/imgs/theme_pic/staskaer.png">
  <link rel="mask-icon" href="/imgs/theme_pic/staskaer.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="阅读orbslam和orbslam2的论文">
<meta property="og:type" content="article">
<meta property="og:title" content="论文阅读--ORBSLAM">
<meta property="og:url" content="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/index.html">
<meta property="og:site_name" content="Staskaer">
<meta property="og:description" content="阅读orbslam和orbslam2的论文">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic1.png">
<meta property="og:image" content="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic2.png">
<meta property="og:image" content="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic3.png">
<meta property="og:image" content="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic4.png">
<meta property="og:image" content="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic5.png">
<meta property="og:image" content="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic7.png">
<meta property="og:image" content="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic6.png">
<meta property="article:published_time" content="2023-09-09T07:47:01.000Z">
<meta property="article:modified_time" content="2023-09-17T06:50:34.823Z">
<meta property="article:author" content="Staskaer">
<meta property="article:tag" content="SLAM">
<meta property="article:tag" content="论文阅读">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic1.png">

<link rel="canonical" href="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>论文阅读--ORBSLAM | Staskaer</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Staskaer</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Hi, this is Staskaer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/imgs/theme_pic/head_img.png">
      <meta itemprop="name" content="Staskaer">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Staskaer">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          论文阅读--ORBSLAM
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-09-09 15:47:01" itemprop="dateCreated datePublished" datetime="2023-09-09T15:47:01+08:00">2023-09-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-17 14:50:34" itemprop="dateModified" datetime="2023-09-17T14:50:34+08:00">2023-09-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SLAM%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">SLAM学习</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>阅读orbslam和orbslam2的论文</p>
<span id="more"></span>
<h2 id="orb-slam1">ORB-SLAM1</h2>
<p>ORB-SLAM3是目前比较牛的VSLAM系统，所以打算从ORB-SLAM1开始看起，先通过论文初步了解一下</p>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1502.00956.pdf">ORB-SLAM: A Versatile
and Accurate Monocular SLAM System</a></p>
<p><strong>(为了方便区分，就称为最初版的ORB-SLAM为ORB-SLAM1，但是实际上，应该只有ORB-SLAM、ORB-SLAM2和ORB-SLAM3)</strong></p>
<p>ORB-SLAM1是沿用了PTAM系统的思想，ORB-SLAM1是使用单目相机，使用ORB特征来完成前端视觉里程计、局部优化、后端的全局优化以及回环检测等任务；ORB-SLAM1使用共视图用于局部轻量级优化；而位姿图则用于后端全局优化；为了降低计算量，ORB-SLAM1使用关键帧来完成优化任务，并非所有帧都参与计算；此外，ORB-SLAM1在跟踪失败后可以快速重建。</p>
<h3 id="在orb-slam1之前的技术框架">在ORB-SLAM1之前的技术框架</h3>
<p>ORB-SLAM1一方面是有创新型工作；但同时它也是一系列工作的集大成者。下面就来说一下ORB-SLAM出来前的一些已有的工作</p>
<h4 id="单目初始化">单目初始化</h4>
<p>由于单目相机构成的SLAM系统在开始的时候没有办法获取到深度信息，所以需要计算本质矩阵或单应矩阵来完成地图的初始化工作。</p>
<p>但是初始化需要通过三角测量来完成，这也就需要使用对极约束来实现，但是这需要稳定的匹配，所以最简单的做法就是：<strong>选用标志性的物体用于初始化</strong>。但是这依然不能保证计算准确，所以一般还需要加入高斯噪声模型，不过一般是认为<strong>深度的倒数的噪声服从高斯分布</strong>（也就是逆深度模型）。</p>
<p>而在重建的时候，如果是在平面上进行平移，那么计算单应矩阵效果更好；而如果是在空间中进行平移，那么计算本质矩阵效果更好。但是显然这两种方法都有各自的缺点，所以ORB-SLAM1采用了<strong>两种方法的结合</strong>，也就是<strong>先计算本质矩阵，然后计算单应矩阵，最后选择重投影误差小的那个</strong>。而如果两者误差都比较大，那么会先不初始化，而是等待深度稳定后再执行初始化操作。</p>
<h4 id="跟踪与建图">跟踪与建图</h4>
<p>对于单目SLAM而言，因为帧率很高，一开始使用滤波技术来处理每一帧，但是短时间内的帧一般都是非常相似的物体，并且会导致误差很容易累计起来。所以后来就使用了<strong>关键帧</strong>来完成跟踪与建图，使用关键帧来进行优化，能提升准确率和优化精度。在PTAM中，就是通过关键帧来完成跟踪与建图，但是PTAM不进行回环检测，且重定位精度比较低。</p>
<p>另外，对于Strasdat提出的大型单目SLAM系统，其前端是在GPU上实现的光流法，并使用FAST特征匹配和局部BA，另外，还有一个基于滑动窗口全局BA。通过具有相似性约束7自由度的姿态图优化来解决回环检测问题，从而校正单目SLAM中出现的尺度漂移。但是他的回环检测也是几月窗口的，只有窗口够大才能覆盖所有的关键帧。在LSD-SLAM中，则是使用直接法来进行半稠密重建，但是它缺乏回环检测且定位精度较低。当然，还有一些其他的工作，比如SVO、DSO等。ORB-SLAM1从这些算法中借鉴了许多跟踪思想，比如使用关键帧、局部BA、回环检测、ORB算子；但是ORB-SLAM1也有自己的创新之处，比如使用共视图来完成局部BA、关键帧使用适者生存（插入关键帧很容易，但是不合适的关键帧会被很快删除）</p>
<h4 id="回环检测">回环检测</h4>
<p>回环检测也是十分重要的，在SLAM中，一般使用词袋模型来完成回环检测。比如FAB-MAP是基于概率的词袋模型；而DBoW2是使用FAST角点和BRIEF特征描述子来构建的。而在ORB-SLAM1中，DBoW2是使用ORB特征来实现的，这样就能在显著降低运算量的同时保证较好的旋转、尺度不变性。（DBoW2是模板化的，因此它可以与任何类型的描述符一起使用，也相当于使用oFAST代替了FAST）</p>
<h3 id="orb-slam1系统">ORB-SLAM1系统</h3>
<p>系统的架构如图所示，它有三个线程：跟踪线程、局部地图线程、回环检测线程。每一帧首先被跟踪线程提取处ORB特征，并检测是否需要初始化地图，并根据每一帧来进行重定位跟踪与关键帧跟踪，这里会使用位姿图BA进行优化；接下来进行局部地图的跟踪，并决定是否将当前帧设置为关键帧。</p>
<p>剩下的所有操作都是基于关键帧的，关键帧首先进入局部建图线程，生成地图点并进行局部BA优化；然后进入回环检测线程，但是ORB-SLAM1是没有全局BA的。</p>
<img src="/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic1.png" class="">
<h4 id="特征选择">特征选择</h4>
<p>ORB-SLAM1顾名思义，只使用ORB特征：特征检测、视觉里程计、优化、回环检测都是<strong>仅使用ORB特征</strong>。</p>
<p>选用ORB特征的原因首先是它快，它比SIFT、SURF这些算子快很多，同时也具有旋转、尺度不变性。另外ORB特征使用BRIEF作为特征描述子，这些特征描述子不是记录梯度或是小波变换，而是记录特定位置的像素亮度的大小，这样在SLAM这种<strong>光照经常变换</strong>的应用中具有更好的效果(因为特征不变时，光照变化，那么像素趋向于是同时变小，如果是记录梯度、小波变换这种，那么描述子的分量也会相应变化，而如果是仅仅比较两个像素的定性量，那么由于亮度同时变换，那么描述子基本不会发生改变)。此外，ORB特征使用BRIEF描述子，仅仅256位，且可以使用汉明距离进行匹配，特征子长度远远小于SIFT或SURF，这样可以大大降低计算量。</p>
<h4 id="特征跟踪局部建图与回环检测">特征跟踪、局部建图与回环检测</h4>
<p>在ORB-SLAM1中，存在三个线程，分别是特征跟踪线程、局部建图线程和回环检测线程。</p>
<p>先来说一下特征跟踪线程。这个线程负责读取所有的帧，然后提取ORB特征，然后进行特征匹配和位姿估计，此时的位姿估计仅仅使用纯<strong>轨迹图</strong>，也就是不优化特征点，仅仅优化相机位姿。如果跟踪失败，那么就会使用<strong>关键帧来进行重定位</strong>，如果在历史关键帧中检测出存在共视图的关键帧，那么就会使用<strong>共视图来重建局部地图</strong>，此时还需要执行BA优化来优化重定位的位姿。此外，特征跟踪线程还会决定是否需要把当前视频帧作为关键帧插入。</p>
<p>而对于局部建图线程而言，它仅仅接受关键帧，然后使用局部关键帧的<strong>BA去优化局部位姿</strong>(这是第二个BA了，第一个BA是在跟踪线程中)。由于新的关键帧肯定是与之前的关键帧存在一定的共视关系，所以利用这个<strong>共视点可以完成三角测量</strong>。此外，这个线程还会剔除掉不合适的关键帧，从而生成高质量的地图点。</p>
<p>而对于回环检测线程，就是在每一个新的关键帧中，都会检测是否存在回环，如果存在回环，那么就会使用<strong>回环关键帧的位姿图进行BA优化</strong>，从而优化整个位姿图，并消除累进误差。</p>
<h4 id="地图点和关键帧的选择">地图点和关键帧的选择</h4>
<p>地图点就是<strong>可以被跟踪的特征点的空间位置</strong>，他是一个三维点，ORB-SLAM会存储每个地图点的空间坐标系坐标、所有观测视角、OBR特描述子、根据ORB旋转不变性限制下的最大最小深度。</p>
<p>而关键帧则是<strong>具有典型性的信息的帧</strong>，它会存储相机位姿、相机内参、所有帧内的ORB特征点</p>
<p>在ORB-SLAM1中，地图点和关键帧的创建条件很宽松，但是能够持续保留下来则比较困难(也就是删除和创建都很容易)，通过这种适者生存的方案，可以兼顾在纹理少时提取足够的地图点，而在纹理多时又选出高质量的地图点。</p>
<h4 id="共视图和本质图">共视图和本质图</h4>
<p>ORB-SLAM1只使用关键帧用于后续的位姿估计、回环检测，可以看成是使用关键帧来对视频流进行采样。而这些相邻两个关键帧之间一般会观察到一些同样的特征点，这些特征点相当于被<strong>共同看到</strong>了，所以可以认为是一种共视的关系，通过这种共视的关系组织成的优化图便是<strong>共视图</strong>。</p>
<p>如果两个相邻的关键帧之间的共视点数目超过15个，那么就认为这两个关键帧之间存在一条边。</p>
<img src="/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic2.png" class="">
<p>理论上通过这些共视图就可以完成优化，但是共视图的边的数目太多，导致进行图优化时计算量大且困难，所以又延伸出了<strong>本质图</strong>。</p>
<p>利用所有关键帧来构建出生成树，这个生成树提供了以<strong>最少边数目连接共视图结点的一个子图</strong>。（也就相当于是最小生成树，共视图中的每个边都有一个表示共视点数目的权重，所以这样生成出来最小生成树可以看成是共视图中仅仅保留最优的共视关系），这样的话，由于丢弃了大量的边，所以计算量大大降低。并且这种方式也不会显著降低BA精度。</p>
<h4 id="词袋回环检测">词袋回环检测</h4>
<p>使用关键帧的ORB特征来构建一个很大视觉向量单词本，然后通过特征词向量进行查询即可获取到对应的回环关键帧。</p>
<h3 id="地图初始化">地图初始化</h3>
<p>由于单目相机需要使用三角测量来进行像素深度估计从而完成地图初始化，而ORB-SLAM1恰好是一个单目相机的SLAM系统。</p>
<p>由于如果是平移变化，那么只需要计算本质矩阵/基础矩阵即可；而如果是在平面上的旋转运动，那么计算单应矩阵会更加合适。在ORB-SLAM1中，使用计算出ORB特征和较好匹配关系，然后会<strong>同时使用两种方法来计算初始化方式，并选择最好的计算结果</strong>。</p>
<p>在计算好基础矩阵和单应矩阵后，会首先计算有效的内点(也就是良好匹配的点)，如果两种方法的内点数目都比较少，那么会重新采集数据并计算基础和单应矩阵。</p>
<p>在计算本质和单应矩阵时，使用的时RANSAC算法，会使用卡方检验来估计内点与外点，并按照检验结果为本质矩阵和单应矩阵计算一个分数，接下来使用一个经验公式来判断到底使用哪个模型来进行估计。在计算完位姿后，还会有一个全局BA来进一步优化位姿。</p>
<p>使用这种方法，虽然有时不能立刻初始化，但是这种方法能获取到较好的初始化结果。</p>
<h3 id="特征跟踪">特征跟踪</h3>
<p>下面来详细阐述一下跟踪线程的内容。特征跟踪线程就是读取所有视频帧、提取ORB特征、进行特征匹配和位姿估计。</p>
<h4 id="orb特征提取">ORB特征提取</h4>
<p>由于ORB要保证尺度等价性，所以要使用图像金字塔来进行检测角点，ORB-SLAM1会尽可能从不同的尺度下提取近似相等的角点数目，这样可以保证在不同的尺度下都能提取到角点。而同样为了保证特征点在不同区域之间是均匀的，会把一个图像分程若干个网格区域，在每个网格内尽可能选择数目相等的点。</p>
<h4 id="位姿估计">位姿估计</h4>
<p>如果当前帧与上一时刻的帧能够完成匹配与跟踪，那么就是用<strong>等速运动模型</strong>来预测相机位姿，也就是假设运动速度是相等的，可以直接计算出位姿，而不需要去重投影什么的。但是如果利用恒速运动模型计算出来的<strong>大量新的特征点的附近无法搜索到观测到的特征点</strong>，那么就认为这个恒速运动模型是不合理的，此时就会使用<strong>重投影误差最小化</strong>来计算位姿。当然，恒速模型在进行匹配的时候也可以使用BA来优化位姿的，从而计算一个较好的位姿。</p>
<img src="/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic3.png" class="">
<p>如果恒速运动模型的匹配结果不好，那么就会<strong>扩大搜索范围</strong>，如果还是找不到，那么就认为是跟丢了，需要进行重定位。</p>
<p>在<strong>重定位</strong>中，首先计算出帧的词袋模型，然后在数据库里查询词袋从而实现全局重定位。如果能够找到合适的关键帧，那么就会使用<strong>PnP算法</strong>来计算位姿，并且会使用<strong>全局BA</strong>来进一步优化位姿。</p>
<p>这三种跟踪模式仅仅跟踪了一帧图像中的特征，没有全局的信息，因此获取的位姿误差较大。</p>
<h4 id="跟踪局部地图">跟踪局部地图</h4>
<p>一旦我们通过上面三种模型获取了初始的相机位姿和初始的特征匹配，就可以<strong>将完整的地图投影到当前帧中去搜索更多的匹配</strong>。这里用局部地图而不是之前所有的关键帧也是为了减少复杂度。这个局部地图包含了关键帧集合К1和К2，其中К1包含了与当前帧有共视关系的所有关键帧，
К2包含了К1的每一帧在共视图中的临近帧。之后在局部地图中再次优化当前帧的位姿。</p>
<p>匹配过程如下：</p>
<ul>
<li>抛弃投影范围超出相机画面的</li>
<li>抛弃观测视角和地图平均观测方向相差60°以上的</li>
<li>抛弃特征点的尺度和地图点的尺度不匹配的</li>
<li>计算当前帧中特征点的尺度</li>
<li>将地图点的描述自和当前帧的ORB特征描述子匹配，根据地图点的尺度位姿获取的粗略投影位置附近进行搜索</li>
</ul>
<p>相机姿势最终会使用帧中找到的<strong>所有地图点进行优化</strong>，这样就相对准确。</p>
<h4 id="插入关键帧">插入关键帧</h4>
<p>最后一步是确定当前帧是否生成为新关键帧。由于存在剔除冗余关键帧的机制，因此我们会尽快插入关键帧，因为这样可以使跟踪对具有相机移动时的变化（通常是旋转）更加可靠。要插入新关键帧，必须满足以下所有条件：</p>
<ul>
<li>距离上一次重定位至少20帧</li>
<li>局部地图线程空闲，或者距离上一次加入关键帧过去了20帧。如果需要关键帧插入（过了20帧）而LocalMapping线程忙，则发送信号给LocalMapping线程，停止局部地图优化，使得新的关键帧可以被及时处理（20帧，大概过去了不到1s）</li>
<li>当前帧跟踪至少50个点，确保了跟踪定位的精确度</li>
<li>当前帧跟踪到LocalMap中参考帧的地图点数量少于90%，确保关键帧之间有明显的视觉变化</li>
</ul>
<h3 id="局部建图">局部建图</h3>
<p>在局部建图线程中，它仅仅使用关键帧来进行处理，在这个线程中，它会首先把新获取的关键帧插入到目前的结构中，然后去掉不太好的地图点并且生成新的地图点，最后使用局部BA来优化关键帧的位姿。在做完这些后，他还会删掉一些不太好的关键帧。</p>
<h4 id="关键帧插入">关键帧插入</h4>
<p>首先，将更新共视图，为当前关键帧<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.661ex" height="1.902ex" role="img" focusable="false" viewBox="0 -683 1176 840.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>创建一个新节点，并更新由与其他关键帧由于存在共视地图点而生成的边。然后，我们更新<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.661ex" height="1.902ex" role="img" focusable="false" viewBox="0 -683 1176 840.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>与具有大多数共视点的关键帧连接的生成树。也就是<strong>先更新共视图，再更新生成树</strong>。最后，还要计算关键帧的词袋，这样在后续对新点进行三角测量时，可以很快的找到对应的新点存在的关键帧。</p>
<h4 id="地图坏点剔除">地图坏点剔除</h4>
<p>所有地图点都必须在它被创建后的前三帧内进行检查，如果不满足条件，那么就会被剔除：</p>
<ul>
<li><span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -1.158ex;" xmlns="http://www.w3.org/2000/svg" width="36.831ex" height="3.447ex" role="img" focusable="false" viewBox="0 -1011.8 16279.5 1523.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(1280.7,481.4) scale(0.707)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">实</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">际</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">观</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">测</text></g><g data-mml-node="mi" transform="translate(4000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">到</text></g><g data-mml-node="mi" transform="translate(5000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">该</text></g><g data-mml-node="mi" transform="translate(6000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">地</text></g><g data-mml-node="mi" transform="translate(7000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">图</text></g><g data-mml-node="mi" transform="translate(8000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">点</text></g><g data-mml-node="mi" transform="translate(9000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">的</text></g><g data-mml-node="mi" transform="translate(10000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">关</text></g><g data-mml-node="mi" transform="translate(11000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">键</text></g><g data-mml-node="mi" transform="translate(12000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">帧</text></g><g data-mml-node="mi" transform="translate(13000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">数</text></g><g data-mml-node="mi" transform="translate(14000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text></g></g><g data-mml-node="mrow" transform="translate(220,-370.3) scale(0.707)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">理</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">论</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">上</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">应</text></g><g data-mml-node="mi" transform="translate(4000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">当</text></g><g data-mml-node="mi" transform="translate(5000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">观</text></g><g data-mml-node="mi" transform="translate(6000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">测</text></g><g data-mml-node="mi" transform="translate(7000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">到</text></g><g data-mml-node="mi" transform="translate(8000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">该</text></g><g data-mml-node="mi" transform="translate(9000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">地</text></g><g data-mml-node="mi" transform="translate(10000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">图</text></g><g data-mml-node="mi" transform="translate(11000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">点</text></g><g data-mml-node="mi" transform="translate(12000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">的</text></g><g data-mml-node="mi" transform="translate(13000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">关</text></g><g data-mml-node="mi" transform="translate(14000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">键</text></g><g data-mml-node="mi" transform="translate(15000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">帧</text></g><g data-mml-node="mi" transform="translate(16000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">数</text></g><g data-mml-node="mi" transform="translate(17000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">目</text></g></g><rect width="12927.9" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(13445.7,0)"><path data-c="2264" d="M674 636Q682 636 688 630T694 615T687 601Q686 600 417 472L151 346L399 228Q687 92 691 87Q694 81 694 76Q694 58 676 56H670L382 192Q92 329 90 331Q83 336 83 348Q84 359 96 365Q104 369 382 500T665 634Q669 636 674 636ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path></g><g data-mml-node="mn" transform="translate(14501.5,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="2E" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z" transform="translate(500,0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(778,0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(1278,0)"></path></g></g></g></svg></mjx-container></span></li>
<li>地图点创建中涉及到了多个关键帧（理论上两帧三角测量即可），那么必须要存在至少三个关键帧能够观测到该地图点</li>
</ul>
<p>如果地图点满足了上述条件，那么它就会被保留。不过如果出现关键帧被剔除，且地图点只能被3个以下的关键帧观测到，那么这个地图点也会被剔除。</p>
<h4 id="地图点的生成">地图点的生成</h4>
<p>只需要使用ORB特征进行匹配，然后计算深度、投影误差，并保证满足对极约束即可。匹配完成后进行三角测量，那么就能得到特征点的地图点。</p>
<p>可能会在多个帧中匹配到相同的地图点，此时要把其余帧中特征点投影到某两个帧上，然后进行计算深度信息。</p>
<h4 id="局部ba">局部BA</h4>
<p>局部BA是利用之前的共视图的局部关系，来优化位姿，同时还涉及到异常点的提剔除。</p>
<p>也就是使用<strong>二阶邻域关系</strong>来构建的局部地图。</p>
<img src="/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic4.png" class="">
<h4 id="关键帧剔除">关键帧剔除</h4>
<p>因为除非新增了场景，否则理论上关键帧数目应该是不会发生变化的（因为总信息有限），所以可以剔除掉重复的关键帧。</p>
<p>在ORB-SLAM1中，会把90%地图点已经在其他至少3个关键帧中可以被观测到的关键帧给删掉。</p>
<h3 id="回环检测-1">回环检测</h3>
<p>回环检测线程就是检测回环，并尝试闭合路径。</p>
<h4 id="回环的检测">回环的检测</h4>
<p>在检测回环的过程中，首先会计算关键帧和他在<strong>共视图中的所有相邻关键帧</strong>的词袋向量，并统计这些词袋向量的相似性，计算出这些最低的相似分数<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="4.791ex" height="1.852ex" role="img" focusable="false" viewBox="0 -661 2117.8 818.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(502,-150) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mi" transform="translate(1172.8,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1517.8,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>。然后在重定位数据库中查询与当前关键帧相似的关键帧，由于这里也能得到一个相似性得分，此时要把所有相似性得分小于上面计算出了的<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="4.791ex" height="1.852ex" role="img" focusable="false" viewBox="0 -661 2117.8 818.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(502,-150) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mi" transform="translate(1172.8,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1517.8,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>的关键帧都给剔除掉。(因为共视的相连关系已经意味着非常相似了，所以用<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="4.791ex" height="1.852ex" role="img" focusable="false" viewBox="0 -661 2117.8 818.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(502,-150) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mi" transform="translate(1172.8,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1517.8,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>作为阈值就表明回环要求比共视关系更相似，相当于是一种动态阈值，可以很好的对抗场景复杂性)</p>
<p>在上述计算完成后，可能会得到一些关键帧，此时还需要剔除掉所有与当前关键帧向量的<strong>候选回环帧</strong>（因为没有正确回环肯定是一种长距离上的累进误差造成的），剩下的与当前关键帧不相连的帧就都被作为<strong>候选回环帧</strong></p>
<img src="/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic5.png" class="">
<h4 id="计算相似变换">计算相似变换</h4>
<p>在匹配到回环帧后，下面就需要计算变换，在单目里有7个自由度(平移3+旋转3+深度1)，所以下面就需要计算这些变换。</p>
<p>会首先匹配两者之间的地图点，然后计算3D-3D的变换，因为可能存在多个后端回环帧，所以需要为每一对都计算变换，接下来，使用RANSAC迭代法，结合Horn方法来计算出变换，童话故事也能得到一个针对内点的相似度，如果内点的相似度够大，那么就会进一步去搜索更多的内点，然后再次计算相似性变化，如果内点够多，那么就认为这个回环是有效的。</p>
<h4 id="回环校正">回环校正</h4>
<p>回环校正是针对共视图中的结点而言的，因为检测出回环，相当于多了一条边。</p>
<p>此时使用计算出来的相似变化来完成两个结点的对齐，然后还需要同时更新关键帧的相邻结点的地图点匹配关系，共视图中所有涉及到的关键帧都需要更新他们的边，从而保证有效闭合</p>
<h4 id="本质图优化">本质图优化</h4>
<p>在得到回环后的共视图后，下一步为了尽可能好的确定位姿关系，所以需要对新的到的本质图进行一次BA优化，这样就能更好的确定位姿关系。</p>
<h3 id="实验结果">实验结果</h3>
<p>ORB-SLAM1在文中很大的篇幅是在做对比实验，但是总是ORB-SLAM1的实验结果都是较好的，所以这里就不再赘述了。</p>
<h2 id="orb-slam2">ORB-SLAM2</h2>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1610.06475.pdf">ORB-SLAM2: an
Open-Source SLAM System for Monocular, Stereo and RGB-D Cameras</a></p>
<p>ORB-SLAM2是对ORB-SLAM1的一次改进，它现在支持单目、双目和RGBD相机了，而之前的ORB-SLAM1仅仅支持单目相机。ORB-SLAM2且不一定需要ROS环境，而ORB-SLAM1则完全基于ROS。另外，ORB-SLAM2可以使用双目、RGBD相机来解决在纯旋转运动时的漂移与丢失。</p>
<p>在流程方面，ORB-SLAM2比ORB-SLAM1多了一个数据预处理部分，这是为了适配多种传感器的必要手段。而且ORB-SLAM2也多了一个全局BA的模块，可以更好的优化位姿。另外ORB-SLAM2还有一个仅定位模式，当对地图进行重建后，可以使用此模式来完成定位，而不需要进行建图，速度更快。</p>
<h3 id="相关技术">相关技术</h3>
<p>在ORB-SLAM2之前，也存在一些基于双目视觉、RGBD相机的SLAM方案，下面来简要介绍一下。</p>
<h4 id="双目slam">双目SLAM</h4>
<p>在此之前，就已经有研究认识到使用双目视觉时，由于基线的限制，导致远点的深度估计是不完全准确的(当点的深度小于基线的40倍时可以准确的三角测量)。大多数的双目SLAM都是基于<strong>关键帧并使用局部BA来优化位姿</strong>，因为局部BA才能保证计算量相对较小，但是这又导致地图较大时可能全局优化位姿。还有一些双目SLAM是基于<strong>光流法的半稠密重建</strong>，它不需要特征，但是可能在相机曝光时间较短时无法准确估计。</p>
<h4 id="rgbd-slam">RGBD SLAM</h4>
<p>由于使用RGBD直接测量了深度，所以得到的都是三维的点，可以直接使用ICP来估计。目前基本上都是把深度融合进图像中，然后使用ICP来跟踪帧与帧之间的特征点运动关系，从而估计出位姿。</p>
<p>当然由于ORB-SLAM2需要同时处理单目、双目、RGBD相机的输入，所以一般都会把双目和RGBD转化成一种统一的深度格式数据，相当于多了一个适配器，用于转换数据格式，从而不影响后续的处理流程。</p>
<h3 id="orb-slam2系统">ORB-SLAM2系统</h3>
<p>ORB-SLAM2和ORB-SLAM1的系统基本上是保持一致的，所以这里主要再介绍下更新的部分。</p>
<img src="/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic7.png" class="">
<h4 id="线程">3+1线程</h4>
<p>ORB-SLAM2沿用了3个常驻线程，也就是特征跟踪、局部建图和回环检测线程，但是从图上可以看到一个额外的全局BA线程。</p>
<p>当回环检测成功后，那么会唤醒全局BA线程来执行一次全局BA优化。</p>
<h4 id="双目与rgbd相机的预处理">双目与RGBD相机的预处理</h4>
<p>ORB-SLAM2会对数据进行预处理，只使用一种格式来表示多种传感器的数据。</p>
<p>对于双目相机的数据，则使用三角测量出深度；对于RGBD相机，则直接把测量的深度融合。这样就能得到一种统一的深度数据格式。</p>
<p>其中双目坐标可以理解成是用于表示深度的坐标；而单目坐标则是双目但是深度不准确或者是单目相机拍摄的图像坐标。</p>
<img src="/2023/09/09/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-ORBSLAM/pic6.png" class="">
<h4 id="单目与双目近远点">单目与双目、近远点</h4>
<p><strong>对于双目相机</strong>：首先必须对双目相机进行外参校正，使其满足对极约束。然后分别从左图和右图计算出ORB特征描述子，对于左图的ORB特征点，沿着右图对应的极线进行搜索匹配的特征(因为已经满足了对极约束)，如果用<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="7.936ex" height="1.441ex" role="img" focusable="false" viewBox="0 -443 3507.7 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(605,-150) scale(0.707)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g><g data-mml-node="mo" transform="translate(865.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="msub" transform="translate(1310.4,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g><g data-mml-node="mo" transform="translate(2089.1,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="msub" transform="translate(2533.8,0)"><g data-mml-node="mi"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(605,-150) scale(0.707)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>分别表示左图的横纵坐标、右图的横坐标，那么对于一个特征点可以表示成<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="9.696ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 4285.7 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msub" transform="translate(389,0)"><g data-mml-node="mi"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(605,-150) scale(0.707)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g><g data-mml-node="mo" transform="translate(1254.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="msub" transform="translate(1699.4,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g><g data-mml-node="mo" transform="translate(2478.1,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="msub" transform="translate(2922.8,0)"><g data-mml-node="mi"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(605,-150) scale(0.707)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(3896.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>，这样就能够表示出深度了（视差）。</p>
<p><strong>对于RGBD相机</strong>：它没有右图，所以可以使用已知的深度来计算出一个等效的<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.203ex" height="1.357ex" role="img" focusable="false" viewBox="0 -442 973.9 599.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(605,-150) scale(0.707)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>，也就是<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.797ex;" xmlns="http://www.w3.org/2000/svg" width="7.97ex" height="3.022ex" role="img" focusable="false" viewBox="0 -983.5 3522.7 1335.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(605,-150) scale(0.707)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g><g data-mml-node="mo" transform="translate(1087.9,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mfrac" transform="translate(2088.2,0)"><g data-mml-node="mrow" transform="translate(220,485) scale(0.707)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mi" transform="translate(523,-150) scale(0.707)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g><g data-mml-node="mi" transform="translate(977.5,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g></g><g data-mml-node="mi" transform="translate(533.4,-345) scale(0.707)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><rect width="1194.5" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></span>，这样就能够得到一个等效的双目坐标了。（也就是逆用双目测量深度时的公式）</p>
<p>上述得到的坐标看起来都是具有深度信息的深度特征点(stereo
keypoints)，但是由于RGBD是存在测量极限的，而对于双目相机，超过基线40倍的深度也是无法测量的，所以ORB-SLAM2将其<strong>分为近点与远点</strong>，对于近点，使用双目坐标，直接通过两帧或RGBD读数测量出深度信息；对于远点，只使用多个帧来测量深度。</p>
<p>因此，近点使用(<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="7.936ex" height="1.441ex" role="img" focusable="false" viewBox="0 -443 3507.7 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(605,-150) scale(0.707)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g><g data-mml-node="mo" transform="translate(865.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="msub" transform="translate(1310.4,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g><g data-mml-node="mo" transform="translate(2089.1,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="msub" transform="translate(2533.8,0)"><g data-mml-node="mi"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(605,-150) scale(0.707)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></g></svg></mjx-container></span>)来表示；而远点则使用(<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="4.726ex" height="1.441ex" role="img" focusable="false" viewBox="0 -443 2089.1 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(605,-150) scale(0.707)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g><g data-mml-node="mo" transform="translate(865.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="msub" transform="translate(1310.4,0)"><g data-mml-node="mi"><path data-c="1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(518,-150) scale(0.707)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g></g></g></g></svg></mjx-container></span>)来表示，也就是分别对应了stereo
keypoints和mono
keypoints。对于近点可以准确的估计平移、旋转、尺度信息，直接执行三角测量或读数是没有问题的；而对于远点，它仅仅能用于提供旋转信息，而深度、平移信息必须通过多个帧进行三角测量的数值才可能是准确的。</p>
<p>上面描述了双目和RGBD相机，而对于<strong>单目相机</strong>而言：所有特征点都是远点，也就是mono
keypoints，必须要通过多个帧来估计深度。</p>
<h4 id="地图初始化-1">地图初始化</h4>
<p>仅有单目SLAM需要初始化，而双目和RGBD相机不需要初始化，因为他们一开始就能获取到深度信息。</p>
<h4 id="不同的ba">不同的BA</h4>
<p>在ORB-SLAM2中，在跟踪线程中使用位姿图执行仅运动BA来估计出相机位姿；在局部建图线程中，使用位姿和地图点来执行局部BA来优化位姿和地图点；在回环检测线程后，使用位姿和地图点来执行全局BA来优化位姿和地图点。</p>
<h4 id="回环检测与全局ba">回环检测与全局BA</h4>
<p>回环检测的步骤与ORB-SLAM1中的类似，但是在ORB-SLAM2中，由于使用了双目/RGBD相机，所以不会出现非常大的漂移现象。另外，回环检测成功后，会唤醒全局BA线程来执行一次全局BA优化，这样就能更好的优化位姿。</p>
<p>不过由于全局BA非常耗时，所以全局BA在单独一个线程中完成。但是又可能会出现在执行全局BA过程中，又重新检测到回环，这时会立刻终止全局BA，等到回环检测完成后再根据新的共视图来执行全局BA。</p>
<h4 id="关键帧插入-1">关键帧插入</h4>
<p>由于ORB-SLAM2又引入了近远点的分类，所以一般会选择近点多的作为关键帧，因为近点的深度估计更加准确，所以可以更好的估计位姿。</p>
<h4 id="仅定位模式">仅定位模式</h4>
<p>当完成建图后，如果地图中场景不会发生显著改变，那么可以考虑使用仅定位模式。在这种模式里，局部地图线程和回环检测线程都会被关闭，相机仅仅通过重定位的方式完成定位。此时，特征跟踪线程使用视觉里程计来完成与地图点的匹配，然后就可以解算出位姿。</p>
<h3 id="实验结果-1">实验结果</h3>
<p>ORB-SLAM2也同样做了很多对比试验，这里就不再赘述了。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SLAM/" rel="tag"># SLAM</a>
              <a href="/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" rel="tag"># 论文阅读</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/09/07/%E5%9C%A8rk3399%E5%B9%B3%E5%8F%B0%E4%B8%8A%E8%BF%90%E8%A1%8Corbslam2/" rel="prev" title="在rk3399平台上运行orbslam2">
      <i class="fa fa-chevron-left"></i> 在rk3399平台上运行orbslam2
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/09/19/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB-%E5%9C%A8RANSAC%E4%B8%8B%E5%9F%BA%E4%BA%8EHC%E5%92%8CML%E7%9A%84%E4%BD%8D%E5%A7%BF%E4%BC%B0%E8%AE%A1%E6%9C%80%E5%B0%8F%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%98/" rel="next" title="论文阅读--在RANSAC下基于HC和ML的位姿估计最小配置问题">
      论文阅读--在RANSAC下基于HC和ML的位姿估计最小配置问题 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#orb-slam1"><span class="nav-number">1.</span> <span class="nav-text">ORB-SLAM1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8orb-slam1%E4%B9%8B%E5%89%8D%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A1%86%E6%9E%B6"><span class="nav-number">1.1.</span> <span class="nav-text">在ORB-SLAM1之前的技术框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">1.1.1.</span> <span class="nav-text">单目初始化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%9F%E8%B8%AA%E4%B8%8E%E5%BB%BA%E5%9B%BE"><span class="nav-number">1.1.2.</span> <span class="nav-text">跟踪与建图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E7%8E%AF%E6%A3%80%E6%B5%8B"><span class="nav-number">1.1.3.</span> <span class="nav-text">回环检测</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#orb-slam1%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.2.</span> <span class="nav-text">ORB-SLAM1系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9"><span class="nav-number">1.2.1.</span> <span class="nav-text">特征选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E5%BE%81%E8%B7%9F%E8%B8%AA%E5%B1%80%E9%83%A8%E5%BB%BA%E5%9B%BE%E4%B8%8E%E5%9B%9E%E7%8E%AF%E6%A3%80%E6%B5%8B"><span class="nav-number">1.2.2.</span> <span class="nav-text">特征跟踪、局部建图与回环检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%B0%E5%9B%BE%E7%82%B9%E5%92%8C%E5%85%B3%E9%94%AE%E5%B8%A7%E7%9A%84%E9%80%89%E6%8B%A9"><span class="nav-number">1.2.3.</span> <span class="nav-text">地图点和关键帧的选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B1%E8%A7%86%E5%9B%BE%E5%92%8C%E6%9C%AC%E8%B4%A8%E5%9B%BE"><span class="nav-number">1.2.4.</span> <span class="nav-text">共视图和本质图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%8D%E8%A2%8B%E5%9B%9E%E7%8E%AF%E6%A3%80%E6%B5%8B"><span class="nav-number">1.2.5.</span> <span class="nav-text">词袋回环检测</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%B0%E5%9B%BE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">1.3.</span> <span class="nav-text">地图初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%BE%81%E8%B7%9F%E8%B8%AA"><span class="nav-number">1.4.</span> <span class="nav-text">特征跟踪</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#orb%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96"><span class="nav-number">1.4.1.</span> <span class="nav-text">ORB特征提取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%8D%E5%A7%BF%E4%BC%B0%E8%AE%A1"><span class="nav-number">1.4.2.</span> <span class="nav-text">位姿估计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%9F%E8%B8%AA%E5%B1%80%E9%83%A8%E5%9C%B0%E5%9B%BE"><span class="nav-number">1.4.3.</span> <span class="nav-text">跟踪局部地图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E5%85%B3%E9%94%AE%E5%B8%A7"><span class="nav-number">1.4.4.</span> <span class="nav-text">插入关键帧</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%80%E9%83%A8%E5%BB%BA%E5%9B%BE"><span class="nav-number">1.5.</span> <span class="nav-text">局部建图</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%B8%A7%E6%8F%92%E5%85%A5"><span class="nav-number">1.5.1.</span> <span class="nav-text">关键帧插入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%B0%E5%9B%BE%E5%9D%8F%E7%82%B9%E5%89%94%E9%99%A4"><span class="nav-number">1.5.2.</span> <span class="nav-text">地图坏点剔除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%B0%E5%9B%BE%E7%82%B9%E7%9A%84%E7%94%9F%E6%88%90"><span class="nav-number">1.5.3.</span> <span class="nav-text">地图点的生成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B1%80%E9%83%A8ba"><span class="nav-number">1.5.4.</span> <span class="nav-text">局部BA</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%B8%A7%E5%89%94%E9%99%A4"><span class="nav-number">1.5.5.</span> <span class="nav-text">关键帧剔除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9E%E7%8E%AF%E6%A3%80%E6%B5%8B-1"><span class="nav-number">1.6.</span> <span class="nav-text">回环检测</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E7%8E%AF%E7%9A%84%E6%A3%80%E6%B5%8B"><span class="nav-number">1.6.1.</span> <span class="nav-text">回环的检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E7%9B%B8%E4%BC%BC%E5%8F%98%E6%8D%A2"><span class="nav-number">1.6.2.</span> <span class="nav-text">计算相似变换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E7%8E%AF%E6%A0%A1%E6%AD%A3"><span class="nav-number">1.6.3.</span> <span class="nav-text">回环校正</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%AC%E8%B4%A8%E5%9B%BE%E4%BC%98%E5%8C%96"><span class="nav-number">1.6.4.</span> <span class="nav-text">本质图优化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C"><span class="nav-number">1.7.</span> <span class="nav-text">实验结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#orb-slam2"><span class="nav-number">2.</span> <span class="nav-text">ORB-SLAM2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF"><span class="nav-number">2.1.</span> <span class="nav-text">相关技术</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8C%E7%9B%AEslam"><span class="nav-number">2.1.1.</span> <span class="nav-text">双目SLAM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#rgbd-slam"><span class="nav-number">2.1.2.</span> <span class="nav-text">RGBD SLAM</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#orb-slam2%E7%B3%BB%E7%BB%9F"><span class="nav-number">2.2.</span> <span class="nav-text">ORB-SLAM2系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B"><span class="nav-number">2.2.1.</span> <span class="nav-text">3+1线程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8C%E7%9B%AE%E4%B8%8Ergbd%E7%9B%B8%E6%9C%BA%E7%9A%84%E9%A2%84%E5%A4%84%E7%90%86"><span class="nav-number">2.2.2.</span> <span class="nav-text">双目与RGBD相机的预处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E7%9B%AE%E4%B8%8E%E5%8F%8C%E7%9B%AE%E8%BF%91%E8%BF%9C%E7%82%B9"><span class="nav-number">2.2.3.</span> <span class="nav-text">单目与双目、近远点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%B0%E5%9B%BE%E5%88%9D%E5%A7%8B%E5%8C%96-1"><span class="nav-number">2.2.4.</span> <span class="nav-text">地图初始化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E7%9A%84ba"><span class="nav-number">2.2.5.</span> <span class="nav-text">不同的BA</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E7%8E%AF%E6%A3%80%E6%B5%8B%E4%B8%8E%E5%85%A8%E5%B1%80ba"><span class="nav-number">2.2.6.</span> <span class="nav-text">回环检测与全局BA</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%B8%A7%E6%8F%92%E5%85%A5-1"><span class="nav-number">2.2.7.</span> <span class="nav-text">关键帧插入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%85%E5%AE%9A%E4%BD%8D%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.2.8.</span> <span class="nav-text">仅定位模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C-1"><span class="nav-number">2.3.</span> <span class="nav-text">实验结果</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Staskaer"
      src="/imgs/theme_pic/head_img.png">
  <p class="site-author-name" itemprop="name">Staskaer</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">79</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Staskaer" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Staskaer" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:liujiaxin011121@gmail.com" title="E-Mail → mailto:liujiaxin011121@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Staskaer</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'xH8NDrh9u4SQrUpQOd0lICnX-MdYXbMMI',
      appKey     : 'jl3JjPS4jsosZG29Zv24Y7LE',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-Hans' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : 'https://xh8ndrh9.api.lncldglobal.com'
    });
  }, window.Valine);
});
</script>

</body>
</html>

