<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/imgs/theme_pic/staskaer.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/imgs/theme_pic/staskaer.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/imgs/theme_pic/staskaer.png">
  <link rel="mask-icon" href="/imgs/theme_pic/staskaer.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null,"activeClass":"valine"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="MASt3R-SLAM与VGGT-SLAM的论文阅读笔记。 前面已经解析过MAST3R和VGGT了，我们接下来看下MASt3R-SLAM与VGGT-SLAM。">
<meta property="og:type" content="article">
<meta property="og:title" content="VGGT-SLAM与MASt3R-SLAM论文阅读">
<meta property="og:url" content="http://example.com/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/index.html">
<meta property="og:site_name" content="Staskaer">
<meta property="og:description" content="MASt3R-SLAM与VGGT-SLAM的论文阅读笔记。 前面已经解析过MAST3R和VGGT了，我们接下来看下MASt3R-SLAM与VGGT-SLAM。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/mast3rslam_pipeline.jpg">
<meta property="og:image" content="http://example.com/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/vggt_submap.png">
<meta property="og:image" content="http://example.com/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/reconstruction_ambiguity.png">
<meta property="og:image" content="http://example.com/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/vggtslam_opt.png">
<meta property="og:image" content="http://example.com/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/sl4-sim3.jpg">
<meta property="article:published_time" content="2025-05-24T14:52:56.000Z">
<meta property="article:modified_time" content="2025-11-15T05:00:39.624Z">
<meta property="article:author" content="Staskaer">
<meta property="article:tag" content="SLAM">
<meta property="article:tag" content="论文阅读">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/mast3rslam_pipeline.jpg">

<link rel="canonical" href="http://example.com/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>VGGT-SLAM与MASt3R-SLAM论文阅读 | Staskaer</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Staskaer</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Hi, this is Staskaer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>links</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/imgs/theme_pic/head_img.png">
      <meta itemprop="name" content="Staskaer">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Staskaer">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          VGGT-SLAM与MASt3R-SLAM论文阅读
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-05-24 22:52:56" itemprop="dateCreated datePublished" datetime="2025-05-24T22:52:56+08:00">2025-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-11-15 13:00:39" itemprop="dateModified" datetime="2025-11-15T13:00:39+08:00">2025-11-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SLAM%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">SLAM学习</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>MASt3R-SLAM与VGGT-SLAM的论文阅读笔记。</p>
<p>前面已经解析过MAST3R和VGGT了，我们接下来看下MASt3R-SLAM与VGGT-SLAM。</p>
<span id="more"></span>
<h2 id="mast3r-slam">MASt3R-SLAM</h2>
<p>MAST3R可以给出两张图像之间的相对位姿和点图，如果将连续的图像都放进来，那么就可以得到这些图像之间的相对位姿，并给出稠密重建的结果。当sfm重建时，因为图像之间没有时间上的连续性，所以需要先根据图像的特征来选出一个联通图，然后两两进行重建。但是因为SLAM系统因为图像是有时间上的顺序的，所以可以像传统的SLAM的系统一样，先选出关键帧，然后每到达一帧后跟关键帧进行结算，并在匹配数目较少的时候插入新的关键帧。</p>
<p>我们后续先来看一下MAST3R-SLAM的数据结构，然后再看下整个的Tracking流程，并最后再看一下优化和匹配的流程。</p>
<h3 id="framesharedstates和sharedkeyframes">Frame、SharedStates和SharedKeyframes</h3>
<p>MAST3R-SLAM使用Frame来管理所有帧，关键帧和普通帧没有本质区别，不过关键帧会全部被存放在SharedKeyframes里</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@dataclasses.dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Frame</span>:</span><br><span class="line">    frame_id: <span class="built_in">int</span></span><br><span class="line">    img_shape: torch.Tensor</span><br><span class="line">    img_true_shape: torch.Tensor</span><br><span class="line">    <span class="comment"># img是3*H*W，存储在device里</span></span><br><span class="line">    img: torch.Tensor</span><br><span class="line">    <span class="comment"># uimg是H*W*3，存储在cpu里</span></span><br><span class="line">    uimg: torch.Tensor</span><br><span class="line">    <span class="comment"># T_WC即当前帧的位姿</span></span><br><span class="line">    T_WC: lietorch.Sim3 = lietorch.Sim3.Identity(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># X_canon是点图</span></span><br><span class="line">    X_canon: <span class="type">Optional</span>[torch.Tensor] = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># C是MAST3R输出的置信度</span></span><br><span class="line">    C: <span class="type">Optional</span>[torch.Tensor] = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># feat是图像计算出来的特征</span></span><br><span class="line">    feat: <span class="type">Optional</span>[torch.Tensor] = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># pos包含了patch的编码</span></span><br><span class="line">    pos: <span class="type">Optional</span>[torch.Tensor] = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># N用来计数，用来平滑置信度C</span></span><br><span class="line">    N: <span class="built_in">int</span> = <span class="number">0</span></span><br><span class="line">    N_updates: <span class="built_in">int</span> = <span class="number">0</span></span><br><span class="line">    K: <span class="type">Optional</span>[torch.Tensor] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_pointmap</span>(<span class="params">self, X: torch.Tensor, C: torch.Tensor</span>):</span><br><span class="line">        <span class="comment"># 因为关键帧会参与多次匹配</span></span><br><span class="line">        <span class="comment"># 在每次匹配时都会按照不同的方案来更新关键帧的点图和置信度</span></span><br><span class="line">        filtering_mode = config[<span class="string">"tracking"</span>][<span class="string">"filtering_mode"</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.N == <span class="number">0</span>:</span><br><span class="line">            self.X_canon = X.clone()</span><br><span class="line">            self.C = C.clone()</span><br><span class="line">            self.N = <span class="number">1</span></span><br><span class="line">            self.N_updates = <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> filtering_mode == <span class="string">"best_score"</span>:</span><br><span class="line">                self.score = self.get_score(C)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> filtering_mode == <span class="string">"first"</span>:</span><br><span class="line">            <span class="keyword">if</span> self.N_updates == <span class="number">1</span>:</span><br><span class="line">                self.X_canon = X.clone()</span><br><span class="line">                self.C = C.clone()</span><br><span class="line">                self.N = <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> filtering_mode == <span class="string">"recent"</span>:</span><br><span class="line">            ...</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SharedKeyframes</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, manager, h, w, buffer=<span class="number">512</span>, dtype=torch.float32, device=<span class="string">"cuda"</span></span>):</span><br><span class="line">        self.lock = manager.RLock()</span><br><span class="line">        self.n_size = manager.Value(<span class="string">"i"</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        self.h, self.w = h, w</span><br><span class="line">        self.buffer = buffer</span><br><span class="line">        self.dtype = dtype</span><br><span class="line">        self.device = device</span><br><span class="line"></span><br><span class="line">        self.feat_dim = <span class="number">1024</span></span><br><span class="line">        self.num_patches = h * w // (<span class="number">16</span> * <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fmt:off</span></span><br><span class="line">        <span class="comment"># 这里会存储所有的KF以及每个KF的变量</span></span><br><span class="line">        self.dataset_idx = torch.zeros(buffer, device=device, dtype=torch.<span class="built_in">int</span>).share_memory_()</span><br><span class="line">        self.img = torch.zeros(buffer, <span class="number">3</span>, h, w, device=device, dtype=dtype).share_memory_()</span><br><span class="line">        self.uimg = torch.zeros(buffer, h, w, <span class="number">3</span>, device=<span class="string">"cpu"</span>, dtype=dtype).share_memory_()</span><br><span class="line">        self.img_shape = torch.zeros(buffer, <span class="number">1</span>, <span class="number">2</span>, device=device, dtype=torch.<span class="built_in">int</span>).share_memory_()</span><br><span class="line">        self.img_true_shape = torch.zeros(buffer, <span class="number">1</span>, <span class="number">2</span>, device=device, dtype=torch.<span class="built_in">int</span>).share_memory_()</span><br><span class="line">        self.T_WC = torch.zeros(buffer, <span class="number">1</span>, lietorch.Sim3.embedded_dim, device=device, dtype=dtype).share_memory_()</span><br><span class="line">        self.X = torch.zeros(buffer, h * w, <span class="number">3</span>, device=device, dtype=dtype).share_memory_()</span><br><span class="line">        self.C = torch.zeros(buffer, h * w, <span class="number">1</span>, device=device, dtype=dtype).share_memory_()</span><br><span class="line">        self.N = torch.zeros(buffer, device=device, dtype=torch.<span class="built_in">int</span>).share_memory_()</span><br><span class="line">        self.N_updates = torch.zeros(buffer, device=device, dtype=torch.<span class="built_in">int</span>).share_memory_()</span><br><span class="line">        self.feat = torch.zeros(buffer, <span class="number">1</span>, self.num_patches, self.feat_dim, device=device, dtype=dtype).share_memory_()</span><br><span class="line">        self.pos = torch.zeros(buffer, <span class="number">1</span>, self.num_patches, <span class="number">2</span>, device=device, dtype=torch.long).share_memory_()</span><br><span class="line">        self.is_dirty = torch.zeros(buffer, <span class="number">1</span>, device=device, dtype=torch.<span class="built_in">bool</span>).share_memory_()</span><br><span class="line">        self.K = torch.zeros(<span class="number">3</span>, <span class="number">3</span>, device=device, dtype=dtype).share_memory_()</span><br><span class="line">        <span class="comment"># fmt: on</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, idx</span>) -&gt; Frame:</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, idx, value: Frame</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<p>另外，MAST3R-SLAM会在SharedStates里存储当前的SLAM系统的状态、以及当前普通帧的各种数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SharedStates</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, manager, h, w, dtype=torch.float32, device=<span class="string">"cuda"</span></span>):</span><br><span class="line">        self.h, self.w = h, w</span><br><span class="line">        self.dtype = dtype</span><br><span class="line">        self.device = device</span><br><span class="line"></span><br><span class="line">        self.lock = manager.RLock()</span><br><span class="line">        self.paused = manager.Value(<span class="string">"i"</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 系统状态</span></span><br><span class="line">        self.mode = manager.Value(<span class="string">"i"</span>, Mode.INIT)</span><br><span class="line">        self.reloc_sem = manager.Value(<span class="string">"i"</span>, <span class="number">0</span>)</span><br><span class="line">        self.global_optimizer_tasks = manager.<span class="built_in">list</span>()</span><br><span class="line">        self.edges_ii = manager.<span class="built_in">list</span>()</span><br><span class="line">        self.edges_jj = manager.<span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line">        self.feat_dim = <span class="number">1024</span></span><br><span class="line">        self.num_patches = h * w // (<span class="number">16</span> * <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fmt:off</span></span><br><span class="line">        <span class="comment"># 存储当前帧的数据，用于重定位</span></span><br><span class="line">        self.dataset_idx = torch.zeros(<span class="number">1</span>, device=device, dtype=torch.<span class="built_in">int</span>).share_memory_()</span><br><span class="line">        self.img = torch.zeros(<span class="number">3</span>, h, w, device=device, dtype=dtype).share_memory_()</span><br><span class="line">        self.uimg = torch.zeros(h, w, <span class="number">3</span>, device=<span class="string">"cpu"</span>, dtype=dtype).share_memory_()</span><br><span class="line">        self.img_shape = torch.zeros(<span class="number">1</span>, <span class="number">2</span>, device=device, dtype=torch.<span class="built_in">int</span>).share_memory_()</span><br><span class="line">        self.img_true_shape = torch.zeros(<span class="number">1</span>, <span class="number">2</span>, device=device, dtype=torch.<span class="built_in">int</span>).share_memory_()</span><br><span class="line">        self.T_WC = lietorch.Sim3.Identity(<span class="number">1</span>, device=device, dtype=dtype).data.share_memory_()</span><br><span class="line">        self.X = torch.zeros(h * w, <span class="number">3</span>, device=device, dtype=dtype).share_memory_()</span><br><span class="line">        self.C = torch.zeros(h * w, <span class="number">1</span>, device=device, dtype=dtype).share_memory_()</span><br><span class="line">        self.feat = torch.zeros(<span class="number">1</span>, self.num_patches, self.feat_dim, device=device, dtype=dtype).share_memory_()</span><br><span class="line">        self.pos = torch.zeros(<span class="number">1</span>, self.num_patches, <span class="number">2</span>, device=device, dtype=torch.long).share_memory_()</span><br></pre></td></tr></table></figure>
<h3 id="mast3r提取特征与匹配">MAST3R提取特征与匹配</h3>
<p>这里先来重新回忆一下MAST3R的结构，有一个encoder来获取图像编码patch的feat以及pos、，然后用decoder来将两个图像的feat解码成第一帧坐标系中的点图(X)、点图置信度(Conf)、编码特征(Desc)以及编码特征置信度(Desc_conf)。</p>
<p>相当于MAST3R只提供了对两张图像进行重建的API，但MAST3R-SLAM需要匹配，所以它有几种“利用API”的方法。</p>
<p>在系统初始化的时候，会利用<code>mast3r_inference_mono</code>将输入图像自身进行重建，并将重建后的点图和特征返回，随后只要对特征进行匹配，就能计算出两帧之间的相对位姿，从而能基于此来构建一个视觉历程计了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@torch.inference_mode</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mast3r_inference_mono</span>(<span class="params">model, frame</span>):</span><br><span class="line">    <span class="keyword">if</span> frame.feat <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># 两张图像都是初始化的图像</span></span><br><span class="line">        frame.feat, frame.pos, _ = model._encode_image(frame.img, frame.img_true_shape)</span><br><span class="line"></span><br><span class="line">    feat = frame.feat</span><br><span class="line">    pos = frame.pos</span><br><span class="line">    shape = frame.img_true_shape</span><br><span class="line"></span><br><span class="line">    res11, res21 = decoder(model, feat, feat, pos, pos, shape, shape)</span><br><span class="line">    res = [res11, res21]</span><br><span class="line">    <span class="comment"># 获取点图、点图置信度、特征、特征置信度</span></span><br><span class="line">    X, C, D, Q = <span class="built_in">zip</span>(</span><br><span class="line">        *[(r[<span class="string">"pts3d"</span>][<span class="number">0</span>], r[<span class="string">"conf"</span>][<span class="number">0</span>], r[<span class="string">"desc"</span>][<span class="number">0</span>], r[<span class="string">"desc_conf"</span>][<span class="number">0</span>]) <span class="keyword">for</span> r <span class="keyword">in</span> res]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    X, C, D, Q = torch.stack(X), torch.stack(C), torch.stack(D), torch.stack(Q)</span><br><span class="line">    X, C, D, Q = downsample(X, C, D, Q)</span><br><span class="line"></span><br><span class="line">    Xii, Xji = einops.rearrange(X, <span class="string">"b h w c -&gt; b (h w) c"</span>)</span><br><span class="line">    Cii, Cji = einops.rearrange(C, <span class="string">"b h w -&gt; b (h w) 1"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 因为两张图像是一样的，所以至给出第一帧的点图和置信度</span></span><br><span class="line">    <span class="keyword">return</span> Xii, Cii</span><br></pre></td></tr></table></figure>
<p>在tracking过程中，会使用两种方式来获取特征后进行匹配，一种是<code>asymmetric</code>，用于正常的跟踪过程中，计算普通帧在当前关键帧下的点图和特征。另一种是<code>symmetric</code>，用于重定位，此时不确定当前普通帧最近的关键帧是哪一个，为了保证匹配的稳定性，沿用了之前MAST3R的匹配流程，需要同时计算普通帧在关键帧的点图和特征、关键帧在普通帧的点图和特征。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@torch.inference_mode</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mast3r_asymmetric_inference</span>(<span class="params">model, frame_i, frame_j</span>):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    feat1, feat2 = frame_i.feat, frame_j.feat</span><br><span class="line">    pos1, pos2 = frame_i.pos, frame_j.pos</span><br><span class="line">    shape1, shape2 = frame_i.img_true_shape, frame_j.img_true_shape</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这里关键帧是图像i，待匹配的普通帧是图像j</span></span><br><span class="line">    <span class="comment"># 只需要获取到j在i坐标系下的点图和特征就够了</span></span><br><span class="line">    res11, res21 = decoder(model, feat1, feat2, pos1, pos2, shape1, shape2)</span><br><span class="line">    res = [res11, res21]</span><br><span class="line">    X, C, D, Q = <span class="built_in">zip</span>(</span><br><span class="line">        *[(r[<span class="string">"pts3d"</span>][<span class="number">0</span>], r[<span class="string">"conf"</span>][<span class="number">0</span>], r[<span class="string">"desc"</span>][<span class="number">0</span>], r[<span class="string">"desc_conf"</span>][<span class="number">0</span>]) <span class="keyword">for</span> r <span class="keyword">in</span> res]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    X, C, D, Q = torch.stack(X), torch.stack(C), torch.stack(D), torch.stack(Q)</span><br><span class="line">    X, C, D, Q = downsample(X, C, D, Q)</span><br><span class="line">    <span class="keyword">return</span> X, C, D, Q</span><br><span class="line"></span><br><span class="line"><span class="meta">@torch.inference_mode</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mast3r_symmetric_inference</span>(<span class="params">model, frame_i, frame_j</span>):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    feat1, feat2 = frame_i.feat, frame_j.feat</span><br><span class="line">    pos1, pos2 = frame_i.pos, frame_j.pos</span><br><span class="line">    shape1, shape2 = frame_i.img_true_shape, frame_j.img_true_shape</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这里关键帧是图像i，待匹配的普通帧是图像j</span></span><br><span class="line">    <span class="comment"># 但是因为需要重定位，所以i和j两个相互图像下的坐标系的点图和特征</span></span><br><span class="line">    res11, res21 = decoder(model, feat1, feat2, pos1, pos2, shape1, shape2)</span><br><span class="line">    res22, res12 = decoder(model, feat2, feat1, pos2, pos1, shape2, shape1)</span><br><span class="line">    res = [res11, res21, res22, res12]</span><br><span class="line">    X, C, D, Q = <span class="built_in">zip</span>(</span><br><span class="line">        *[(r[<span class="string">"pts3d"</span>][<span class="number">0</span>], r[<span class="string">"conf"</span>][<span class="number">0</span>], r[<span class="string">"desc"</span>][<span class="number">0</span>], r[<span class="string">"desc_conf"</span>][<span class="number">0</span>]) <span class="keyword">for</span> r <span class="keyword">in</span> res]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    X, C, D, Q = torch.stack(X), torch.stack(C), torch.stack(D), torch.stack(Q)</span><br><span class="line">    X, C, D, Q = downsample(X, C, D, Q)</span><br><span class="line">    <span class="keyword">return</span> X, C, D, Q</span><br></pre></td></tr></table></figure>
<p>可能这里会稍微有一点绕，因为API比较多，包含了batch和inference以及带有matching封装的好几种情况，但只要关注<code>mast3r_match_asymmetric</code>和<code>mast3r_match_symmetric</code>这两个就可以了，他们包含了特征提取与匹配着两个步骤。其中<code>mast3r_match_asymmetric</code>用于tracking过程中，只计算每个普通帧在最近关键帧下的匹配（即单向匹配，固定在关键帧下）；而<code>mast3r_match_symmetric</code>用于后端优化中，需要计算两个关键帧之间的双向匹配（也就是需要计算两次）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mast3r_match_asymmetric</span>(<span class="params">model, frame_i, frame_j, idx_i2j_init=<span class="literal">None</span></span>):</span><br><span class="line">    X, C, D, Q = mast3r_asymmetric_inference(model, frame_i, frame_j)</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Xii，Xji分别为i帧和j帧在i帧坐标系下的点图；Dii，Dji分别为i帧和j帧在i帧坐标系下的特征描述子</span></span><br><span class="line">    <span class="comment"># 用上一次的匹配结果作为初始化，类似orbslam中恒速度先验匹配</span></span><br><span class="line">    idx_i2j, valid_match_j = matching.<span class="keyword">match</span>(</span><br><span class="line">        Xii, Xji, Dii, Dji, idx_1_to_2_init=idx_i2j_init</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回frame-&gt;keyframe的像素索引映射，匹配成功标记。以及点图，置信度和描述子置信度</span></span><br><span class="line">    <span class="keyword">return</span> idx_i2j, valid_match_j, Xii, Cii, Qii, Xji, Cji, Qji</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mast3r_match_symmetric</span>(<span class="params">model, feat_i, pos_i, feat_j, pos_j, shape_i, shape_j</span>):</span><br><span class="line">    X, C, D, Q = mast3r_decode_symmetric_batch(</span><br><span class="line">        model, feat_i, pos_i, feat_j, pos_j, shape_i, shape_j</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 双向匹配，Xii&lt;-&gt;Xji, Xjj&lt;-&gt;Xij</span></span><br><span class="line">    X11 = torch.cat((Xii, Xjj), dim=<span class="number">0</span>)</span><br><span class="line">    X21 = torch.cat((Xji, Xij), dim=<span class="number">0</span>)</span><br><span class="line">    D11 = torch.cat((Dii, Djj), dim=<span class="number">0</span>)</span><br><span class="line">    D21 = torch.cat((Dji, Dij), dim=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    idx_1_to_2, valid_match_2 = matching.<span class="keyword">match</span>(X11, X21, D11, D21)</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 返回值类似，只不过这个函数只会在优化时调用，所以只用返回置信度用于后续筛选就行了</span></span><br><span class="line">    <span class="keyword">return</span> idx_i2j, idx_j2i, valid_match_j, valid_match_i, Qii.view(b, -<span class="number">1</span>, <span class="number">1</span>), Qjj.view(b, -<span class="number">1</span>, <span class="number">1</span>), Qji.view(b, -<span class="number">1</span>, <span class="number">1</span>), Qij.view(b, -<span class="number">1</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>最后来看一下<code>match</code>这个函数，匹配过程的核心逻辑部分在CUDA内核里实现。当给定两帧的点图（光心出发的光线遇到的第一个相交的空间点）时，可以把每个3D点归一化为单位向量，得到“射线方向图”（ray image）。匹配通过最小化射线方向误差来建立对应，针对第二帧的每个射线，在第一帧的射线场上以给定初值为中心做局部的亚像素优化，也就是找到一个像素位置 (u,v)，使该位置的视线方向与该3D点的方向误差最小。注意MAST3R中的点图已经处于同一坐标系下，不然只比较方向是没有意义的。除此之外还会基于三维欧氏距离做额外过滤，若基于夹角的粗匹配对应处的3D点距离太大，则判定为不匹配。</p>
<div class="note info">
            <p>之所以采用这种基于射线方向的方法，一是便于在不知道相机内参或无法直接投影的场景下使用，二是在帧间运动较小时可以用前一帧的结果作为良好初值，从而保证匹配可靠性。相比之下，像KD-tree在并行化上困难，mast3r里的fast nn在实际复杂度和并行效率上也有缺陷。</p><p>另外，第一步粗匹配是通过射线夹角和欧式距离来完成的，第二步精匹配是在第一步匹配的邻域内，使用MAST3R输出的特征描述子做点积来找一个最佳匹配。</p>
          </div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">prep_for_iter_proj</span>(<span class="params">X11, X21, idx_1_to_2_init</span>):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Ray image</span></span><br><span class="line">    <span class="comment"># 将原图归一化以及xy方向梯度图拼接在一起</span></span><br><span class="line">    <span class="comment"># 梯度的作用是在cuda中实现lm</span></span><br><span class="line">    rays_img = F.normalize(X11, dim=-<span class="number">1</span>)</span><br><span class="line">    rays_img = rays_img.permute(<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># (b,c,h,w)</span></span><br><span class="line">    gx_img, gy_img = img_utils.img_gradient(rays_img)</span><br><span class="line">    rays_with_grad_img = torch.cat((rays_img, gx_img, gy_img), dim=<span class="number">1</span>)</span><br><span class="line">    rays_with_grad_img = rays_with_grad_img.permute(</span><br><span class="line">        <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span></span><br><span class="line">    ).contiguous()  <span class="comment"># (b,h,w,c)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3D points to project</span></span><br><span class="line">    <span class="comment"># 而待匹配的图像展开为向量</span></span><br><span class="line">    <span class="comment"># 展开感觉只是因为在cuda中方便处理，不用处理二维网格情况</span></span><br><span class="line">    X21_vec = X21.view(b, -<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">    pts3d_norm = F.normalize(X21_vec, dim=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rays_with_grad_img, pts3d_norm, p_init</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">match_iterative_proj</span>(<span class="params">X11, X21, D11, D21, idx_1_to_2_init=<span class="literal">None</span></span>):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    rays_with_grad_img, pts3d_norm, p_init = prep_for_iter_proj(</span><br><span class="line">        X11, X21, idx_1_to_2_init</span><br><span class="line">    )</span><br><span class="line">    p1, valid_proj2 = mast3r_slam_backends.iter_proj(</span><br><span class="line">        rays_with_grad_img,</span><br><span class="line">        pts3d_norm,</span><br><span class="line">        p_init,</span><br><span class="line">        cfg[<span class="string">"max_iter"</span>],</span><br><span class="line">        cfg[<span class="string">"lambda_init"</span>],</span><br><span class="line">        cfg[<span class="string">"convergence_thresh"</span>],</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 基于空间上欧式距离来过滤到伪匹配</span></span><br><span class="line">    batch_inds = torch.arange(b, device=device)[:, <span class="literal">None</span>].repeat(<span class="number">1</span>, h * w)</span><br><span class="line">    dists2 = torch.linalg.norm(</span><br><span class="line">        X11[batch_inds, p1[..., <span class="number">1</span>], p1[..., <span class="number">0</span>], :].reshape(b, h, w, <span class="number">3</span>) - X21, dim=-<span class="number">1</span></span><br><span class="line">    )</span><br><span class="line">    valid_dists2 = (dists2 &lt; cfg[<span class="string">"dist_thresh"</span>]).view(b, -<span class="number">1</span>)</span><br><span class="line">    valid_proj2 = valid_proj2 &amp; valid_dists2</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在邻域内做进一步的匹配，使用描述子做点积</span></span><br><span class="line">    <span class="keyword">if</span> cfg[<span class="string">"radius"</span>] &gt; <span class="number">0</span>:</span><br><span class="line">        (p1,) = mast3r_slam_backends.refine_matches(</span><br><span class="line">            D11.half(),</span><br><span class="line">            D21.view(b, h * w, -<span class="number">1</span>).half(),</span><br><span class="line">            p1,</span><br><span class="line">            cfg[<span class="string">"radius"</span>],</span><br><span class="line">            cfg[<span class="string">"dilation_max"</span>],</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Convert to linear index</span></span><br><span class="line">    idx_1_to_2 = pixel_to_lin(p1, w)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> idx_1_to_2, valid_proj2.unsqueeze(-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h3 id="系统入口与tracking">系统入口与Tracking</h3>
<p>然后我们来看一下整个系统的流程，整个系统有两个线程，一个主线程负责初始化系统和跟踪每一帧，而优化线程负责在添加关键帧后进行优化以及重定位。</p>
<img src="/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/mast3rslam_pipeline.jpg" class="">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 可视化线程</span></span><br><span class="line">    manager = mp.Manager()</span><br><span class="line">    main2viz = new_queue(manager, args.no_viz)</span><br><span class="line">    viz2main = new_queue(manager, args.no_viz)</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SharedKeyframes来管理所有的KF，states存储当前系统的状态</span></span><br><span class="line">    keyframes = SharedKeyframes(manager, h, w)</span><br><span class="line">    states = SharedStates(manager, h, w)</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建tracking线程，用于跟踪每一帧</span></span><br><span class="line">    tracker = FrameTracker(model, keyframes, device)</span><br><span class="line">    last_msg = WindowMsg()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 后端优化线程，包括重定位和GBA</span></span><br><span class="line">    backend = mp.Process(target=run_backend, args=(config, model, states, keyframes, K))</span><br><span class="line">    backend.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 创建当前普通帧的frame</span></span><br><span class="line">        mode = states.get_mode()</span><br><span class="line">        frame = create_frame(i, img, T_WC, img_size=dataset.img_size, device=device)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 系统初始化</span></span><br><span class="line">        <span class="keyword">if</span> mode == Mode.INIT:</span><br><span class="line">            X_init, C_init = mast3r_inference_mono(model, frame)</span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 跟踪每一帧</span></span><br><span class="line">        <span class="keyword">if</span> mode == Mode.TRACKING:</span><br><span class="line">            add_new_kf, match_info, try_reloc = tracker.track(frame)</span><br><span class="line">            <span class="keyword">if</span> try_reloc:</span><br><span class="line">                states.set_mode(Mode.RELOC)</span><br><span class="line">            states.set_frame(frame)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 跟丢时设置重定位flag，由优化线程执行</span></span><br><span class="line">        <span class="keyword">elif</span> mode == Mode.RELOC:</span><br><span class="line">            X, C = mast3r_inference_mono(model, frame)</span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 当跟踪过程中匹配数目较低时添加新的关键帧</span></span><br><span class="line">        <span class="comment"># 并在添加关键帧后执行优化</span></span><br><span class="line">        <span class="keyword">if</span> add_new_kf:</span><br><span class="line">            keyframes.append(frame)</span><br><span class="line">            states.queue_global_optimization(<span class="built_in">len</span>(keyframes) - <span class="number">1</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>而tracking流程也不复杂，把每一帧和最近的关键帧用MAST3R计算点图并得到匹配点，然后用优化的方法来求解普通帧相对于关键帧的位姿，这样就实现了跟踪流程。在优化时，当没有给定相机内参时比较简单，误差为变换前后的射线场之间的夹角（不优化点图的欧式距离是因为远处的估计结果不准确，会拉高平均误差，而夹角本身相当于一种额外的先验加权）；在给定内参时情况比较复杂，会同时优化重投影误差和对数深度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FrameTracker</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">track</span>(<span class="params">self, frame: Frame</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        idx_f2k, valid_match_k, Xff, Cff, Qff, Xkf, Ckf, Qkf = mast3r_match_asymmetric(</span><br><span class="line">            self.model, frame, keyframe, idx_i2j_init=self.idx_f2k</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Track</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> use_calib:</span><br><span class="line">                T_WCf, T_CkCf = self.opt_pose_ray_dist_sim3(Xf, Xk, T_WCf, T_WCk, Qk, valid_opt)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                T_WCf, T_CkCf = self.opt_pose_calib_sim3(Xf,Xk,T_WCf,T_WCk,Qk,valid_opt,meas_k,valid_meas_k,K,img_size)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"Cholesky failed <span class="subst">{frame.frame_id}</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span>, [], <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Keyframe selection</span></span><br><span class="line">        n_valid = valid_kf.<span class="built_in">sum</span>()</span><br><span class="line">        match_frac_k = n_valid / valid_kf.numel()</span><br><span class="line">        unique_frac_f = (</span><br><span class="line">            torch.unique(idx_f2k[valid_match_k[:, <span class="number">0</span>]]).shape[<span class="number">0</span>] / valid_kf.numel()</span><br><span class="line">        )</span><br><span class="line">        new_kf = <span class="built_in">min</span>(match_frac_k, unique_frac_f) &lt; self.cfg[<span class="string">"match_frac_thresh"</span>]</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 优化不带相机内参情况</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">opt_pose_ray_dist_sim3</span>(<span class="params">self, Xf, Xk, T_WCf, T_WCk, Qk, valid</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Solving for relative pose without scale!</span></span><br><span class="line">        T_CkCf = T_WCk.inv() * T_WCf</span><br><span class="line">        <span class="comment"># Precalculate distance and ray for obs k</span></span><br><span class="line">        <span class="comment"># 计算关键帧点图归一化</span></span><br><span class="line">        rd_k = point_to_ray_dist(Xk, jacobian=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        old_cost = <span class="built_in">float</span>(<span class="string">"inf"</span>)</span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(self.cfg[<span class="string">"max_iters"</span>]):</span><br><span class="line">            Xf_Ck, dXf_Ck_dT_CkCf = act_Sim3(T_CkCf, Xf, jacobian=<span class="literal">True</span>)</span><br><span class="line">            rd_f_Ck, drd_f_Ck_dXf_Ck = point_to_ray_dist(Xf_Ck, jacobian=<span class="literal">True</span>)</span><br><span class="line">            <span class="comment"># r = z-h(x)</span></span><br><span class="line">            <span class="comment"># 优化普通帧和关键帧射线的夹角</span></span><br><span class="line">            r = rd_k - rd_f_Ck</span><br><span class="line">            <span class="comment"># Jacobian</span></span><br><span class="line">            ...</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 带有内参的优化求解</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">opt_pose_calib_sim3</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self, Xf, Xk, T_WCf, T_WCk, Qk, valid, meas_k, valid_meas_k, K, img_size</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Solving for relative pose without scale!</span></span><br><span class="line">        T_CkCf = T_WCk.inv() * T_WCf</span><br><span class="line"></span><br><span class="line">        old_cost = <span class="built_in">float</span>(<span class="string">"inf"</span>)</span><br><span class="line">        <span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(self.cfg[<span class="string">"max_iters"</span>]):</span><br><span class="line">            Xf_Ck, dXf_Ck_dT_CkCf = act_Sim3(T_CkCf, Xf, jacobian=<span class="literal">True</span>)</span><br><span class="line">            <span class="comment"># 重投影误差+对数深度，见下</span></span><br><span class="line">            pzf_Ck, dpzf_Ck_dXf_Ck, valid_proj = project_calib(</span><br><span class="line">                Xf_Ck,</span><br><span class="line">                K,</span><br><span class="line">                img_size,</span><br><span class="line">                jacobian=<span class="literal">True</span>,</span><br><span class="line">                border=self.cfg[<span class="string">"pixel_border"</span>],</span><br><span class="line">                z_eps=self.cfg[<span class="string">"depth_eps"</span>],</span><br><span class="line">            )</span><br><span class="line">            valid2 = valid_proj &amp; valid_meas_k</span><br><span class="line">            sqrt_info2 = valid2 * sqrt_info</span><br><span class="line">            <span class="comment"># r = z-h(x)</span></span><br><span class="line">            <span class="comment"># 这里meas_k = [u, v, log(z_k)] pzf_Ck=[u_pred, v_pred, log(z_pred)]</span></span><br><span class="line">            r = meas_k - pzf_Ck</span><br><span class="line">            <span class="comment"># Jacobian</span></span><br><span class="line">            ...</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">project_calib</span>(<span class="params">P, K, img_size, jacobian=<span class="literal">False</span>, border=<span class="number">0</span>, z_eps=<span class="number">0.0</span></span>):</span><br><span class="line">    <span class="comment"># 重投影部分略去</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Depth transformation</span></span><br><span class="line">    logz = torch.log(z)</span><br><span class="line">    invalid_z = torch.logical_not(valid_z)</span><br><span class="line">    logz[invalid_z] = <span class="number">0.0</span>  <span class="comment"># Need to avoid nans</span></span><br><span class="line"></span><br><span class="line">    pz = torch.cat((p, logz), dim=-<span class="number">1</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>Tracking过程中还会根据匹配点数目来判断是否需要添加关键帧以及是否跟丢，总体来说还是比较简单的。</p>
<h3 id="重定位回环检测与optimization">重定位、回环检测与Optimization</h3>
<p>MAST3R中的重定位和优化部分高度耦合在一起，一般情况下都位于一个单独的进程中，如果在tracking过程中出现跟丢情况，那么优化线程会检测这个flag然后进入重定位流程，否则就继续进行全局优化。全局优化的代码也同样是在CUDA中实现的，跟Tracking中求解位姿差不多，有内参时用一个类似重投影误差来优化，没有内参时用一个ray的夹角来作为目标函数。在执行全局优化时，每个CUDA线程处理的是一条边（即一对匹配点多的关键帧），与之对比，在Tracking中的每个CUDA线程处理的是每一条ray。</p>
<p>无论是在重定位还是回环检测，MAST3R-SLAM都高度依赖Retrieval Database，大致原理是用把每张图像的feat经过白化等操作后后选出top-k的局部特征构建的相似度查询数据库。（当然这部分我就大概看了一下，不是特别感兴趣）。先来说回环检测，MAST3R-SLAM并没有像ORB-SLAM那样构造一个非常复杂的检测器，而是跟全局优化耦合在一起，每次为一个关键帧构建图优化时，会将 1）该关键帧前几个相邻的关键帧 2）通过Retrieval Database查询出来与当前关键帧相似的一系列关键帧 一起作为候选回环关键帧，然后调用<code>add_factors</code>函数为图优化添加新的边，这个函数会使用<code>mast3r_match_symmetric</code>来对候选回环关键帧进行匹配，移除掉那些匹配数目不够的候选回环关键帧，然后将这些边全部新增到图优化中进行全局优化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run_backend</span>(<span class="params">cfg, model, states, keyframes, K</span>):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> mode <span class="keyword">is</span> <span class="keyword">not</span> Mode.TERMINATED:</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 重定位</span></span><br><span class="line">        <span class="keyword">if</span> mode == Mode.RELOC:</span><br><span class="line">            frame = states.get_frame()</span><br><span class="line">            success = relocalization(frame, keyframes, factor_graph, retrieval_database)</span><br><span class="line">            <span class="keyword">if</span> success:</span><br><span class="line">                states.set_mode(Mode.TRACKING)</span><br><span class="line">            states.dequeue_reloc()</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 从待优化列表中拿出要构建优化的关键帧</span></span><br><span class="line">        <span class="keyword">with</span> states.lock:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(states.global_optimizer_tasks) &gt; <span class="number">0</span>:</span><br><span class="line">                idx = states.global_optimizer_tasks[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Graph Construction</span></span><br><span class="line">        kf_idx = []</span><br><span class="line">        <span class="comment"># k to previous consecutive keyframes</span></span><br><span class="line">        <span class="comment"># 将当前关键帧最近的几个关键帧放入候选回环集合中</span></span><br><span class="line">        n_consec = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">min</span>(n_consec, idx)):</span><br><span class="line">            kf_idx.append(idx - <span class="number">1</span> - j)</span><br><span class="line">        frame = keyframes[idx]</span><br><span class="line">        <span class="comment"># 查询潜在的回环关键帧</span></span><br><span class="line">        retrieval_inds = retrieval_database.update(frame,add_after_query=<span class="literal">True</span>,k=config[<span class="string">"retrieval"</span>][<span class="string">"k"</span>],min_thresh=config[<span class="string">"retrieval"</span>][<span class="string">"min_thresh"</span>],)</span><br><span class="line">        kf_idx += retrieval_inds</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 为这一关键帧尝试创建边并添加到图优化中</span></span><br><span class="line">        <span class="keyword">if</span> kf_idx:</span><br><span class="line">            factor_graph.add_factors(</span><br><span class="line">                kf_idx, frame_idx, config[<span class="string">"local_opt"</span>][<span class="string">"min_match_frac"</span>]</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> config[<span class="string">"use_calib"</span>]:</span><br><span class="line">            factor_graph.solve_GN_calib()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            factor_graph.solve_GN_rays()</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<p>而对于重定位而言，基本逻辑与回环检测类似，只不过重定位时，会将当前普通帧临时升级为关键帧（如果重定位成功，就永久升级为关键帧，否则就会被踢掉），然后利用Retrieval Database查询所有相似度高的帧，并尝试构建图优化，这里并不像回环检测一样，重定位有一个strict选项，如果这个选项为真，那么要求所有重定位候选帧都必须能够和当前帧有较多的匹配才认为是重定位成功。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">relocalization</span>(<span class="params">frame, keyframes, factor_graph, retrieval_database</span>):</span><br><span class="line">    <span class="keyword">with</span> keyframes.lock:</span><br><span class="line">        kf_idx = []</span><br><span class="line">        <span class="comment"># 找出候选重定位帧</span></span><br><span class="line">        retrieval_inds = retrieval_database.update(</span><br><span class="line">            frame,</span><br><span class="line">            add_after_query=<span class="literal">False</span>,</span><br><span class="line">            k=config[<span class="string">"retrieval"</span>][<span class="string">"k"</span>],</span><br><span class="line">            min_thresh=config[<span class="string">"retrieval"</span>][<span class="string">"min_thresh"</span>],</span><br><span class="line">        )</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> kf_idx:</span><br><span class="line">            ...</span><br><span class="line">            <span class="comment"># 候选重定位帧与当前帧构建图优化</span></span><br><span class="line">            <span class="keyword">if</span> factor_graph.add_factors(frame_idx,kf_idx,config[<span class="string">"reloc"</span>][<span class="string">"min_match_frac"</span>],is_reloc=config[<span class="string">"reloc"</span>][<span class="string">"strict"</span>]):</span><br><span class="line">                retrieval_database.update(frame,add_after_query=<span class="literal">True</span>,k=config[<span class="string">"retrieval"</span>][<span class="string">"k"</span>],min_thresh=config[<span class="string">"retrieval"</span>][<span class="string">"min_thresh"</span>],)</span><br><span class="line">                successful_loop_closure = <span class="literal">True</span></span><br><span class="line">                keyframes.T_WC[n_kf - <span class="number">1</span>] = keyframes.T_WC[kf_idx[<span class="number">0</span>]].clone()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 重定位失败将临时提升的关键帧移除</span></span><br><span class="line">                keyframes.pop_last()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Failed to relocalize"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> successful_loop_closure:</span><br><span class="line">            <span class="keyword">if</span> config[<span class="string">"use_calib"</span>]:</span><br><span class="line">                factor_graph.solve_GN_calib()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                factor_graph.solve_GN_rays()</span><br><span class="line">        <span class="keyword">return</span> successful_loop_closure</span><br></pre></td></tr></table></figure>
<p>当然，这里面最关键的构建图优化的函数是<code>add_factors</code>，它就是利用MAST3R输出的特征来进行双向匹配（这个上面讲过了），再结合置信度和匹配数目筛选掉不太行的候选帧。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FactorGraph</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_factors</span>(<span class="params">self, ii, jj, min_match_frac, is_reloc=<span class="literal">False</span></span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment"># mast3r_match_symmetric双向特征匹配</span></span><br><span class="line">        idx_i2j,idx_j2i,valid_match_j,valid_match_i,Qii,Qjj,Qji,Qij = mast3r_match_symmetric(</span><br><span class="line">            self.model, feat_i, pos_i, feat_j, pos_j, shape_i, shape_j</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 置信度+匹配数目筛选</span></span><br><span class="line">        valid_Qj = Qj &gt; self.cfg[<span class="string">"Q_conf"</span>]</span><br><span class="line">        valid_Qi = Qi &gt; self.cfg[<span class="string">"Q_conf"</span>]</span><br><span class="line">        valid_j = valid_match_j &amp; valid_Qj</span><br><span class="line">        valid_i = valid_match_i &amp; valid_Qi</span><br><span class="line">        nj = valid_j.shape[<span class="number">1</span>] * valid_j.shape[<span class="number">2</span>]</span><br><span class="line">        ni = valid_i.shape[<span class="number">1</span>] * valid_i.shape[<span class="number">2</span>]</span><br><span class="line">        match_frac_j = valid_j.<span class="built_in">sum</span>(dim=(<span class="number">1</span>, <span class="number">2</span>)) / nj</span><br><span class="line">        match_frac_i = valid_i.<span class="built_in">sum</span>(dim=(<span class="number">1</span>, <span class="number">2</span>)) / ni</span><br><span class="line">        ii_tensor = torch.as_tensor(ii, device=self.device)</span><br><span class="line">        jj_tensor = torch.as_tensor(jj, device=self.device)</span><br><span class="line"></span><br><span class="line">        invalid_edges = torch.minimum(match_frac_j, match_frac_i) &lt; min_match_frac</span><br><span class="line">        consecutive_edges = ii_tensor == (jj_tensor - <span class="number">1</span>)</span><br><span class="line">        invalid_edges = (~consecutive_edges) &amp; invalid_edges</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 重定位时如果strict=True，那么要求所有候选帧都是有效的</span></span><br><span class="line">        <span class="keyword">if</span> invalid_edges.<span class="built_in">any</span>() <span class="keyword">and</span> is_reloc:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 剩下的部分就是从候选帧中选出有效的部分，准备数据方便后面优化</span></span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>
<p>最后来看下优化中的CUDA实现，同样的，这里也分为无标定和有标定，但是与tracking中的优化情况略有不同，在这里会将每条图优化的边映射到一个CUDA block上，然后block的每个CUDA thread来处理匹配点的jacobian以及残差等东西。在无标定参数的情况下，优化目标为两条ray之间的角度差+归一化后的ray的距离误差，不直接优化ray的距离的原因上面已经提到过了；而在有标定参数的情况下会优化重投影误差+对数深度误差，跟匹配的时候类似。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> GPU_1D_KERNEL_LOOP(k, n) \</span></span><br><span class="line"><span class="meta">  for (size_t k = threadIdx.x; k &lt; n; k += blockDim.x)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 无标定参数</span></span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">ray_align_kernel</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  ...</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">GPU_1D_KERNEL_LOOP</span>(k, num_points) {</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Normalize measurement point</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> norm2_i = <span class="built_in">squared_norm3</span>(Xi);</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> norm1_i = <span class="built_in">sqrtf</span>(norm2_i);</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> norm1_i_inv = <span class="number">1.0</span>/norm1_i;    </span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> ri[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) ri[i] = norm1_i_inv * Xi[i];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Transform point</span></span><br><span class="line">    <span class="built_in">actSim3</span>(tij, qij, sij, Xj, Xj_Ci);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Get predicted point norm</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> norm2_j = <span class="built_in">squared_norm3</span>(Xj_Ci);</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> norm1_j = <span class="built_in">sqrtf</span>(norm2_j);</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> norm1_j_inv = <span class="number">1.0</span>/norm1_j;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> rj_Ci[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) rj_Ci[i] = norm1_j_inv * Xj_Ci[i];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Error (difference in camera rays)</span></span><br><span class="line">    <span class="comment">// 优化目标：两条ray的夹角+归一化后的ray的顶点误差</span></span><br><span class="line">    err[<span class="number">0</span>] = rj_Ci[<span class="number">0</span>] - ri[<span class="number">0</span>];</span><br><span class="line">    err[<span class="number">1</span>] = rj_Ci[<span class="number">1</span>] - ri[<span class="number">1</span>];</span><br><span class="line">    err[<span class="number">2</span>] = rj_Ci[<span class="number">2</span>] - ri[<span class="number">2</span>];</span><br><span class="line">    err[<span class="number">3</span>] = norm1_j - norm1_i; <span class="comment">// Distance</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Weights (Huber)</span></span><br><span class="line">    <span class="comment">// 根据置信度筛选有效匹配点</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> q = Q[block_id][k][<span class="number">0</span>];</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> ci = Cs[ix][ind_Xi][<span class="number">0</span>];</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> cj = Cs[jx][k][<span class="number">0</span>];</span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> valid = </span><br><span class="line">      valid_match_ind</span><br><span class="line">      &amp; (q &gt; Q_thresh)</span><br><span class="line">      &amp; (ci &gt; C_thresh)</span><br><span class="line">      &amp; (cj &gt; C_thresh);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Weight using confidences</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> conf_weight = q;</span><br><span class="line">    <span class="comment">// const float conf_weight = q * ci * cj;</span></span><br><span class="line">    <span class="comment">// sigma_ray_inv和sigma_dist_inv是传入的参数，用于控制置信度</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> sqrt_w_ray = valid ? sigma_ray_inv * <span class="built_in">sqrtf</span>(conf_weight) : <span class="number">0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> sqrt_w_dist = valid ? sigma_dist_inv * <span class="built_in">sqrtf</span>(conf_weight) : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Robust weight</span></span><br><span class="line">    w[<span class="number">0</span>] = <span class="built_in">huber</span>(sqrt_w_ray * err[<span class="number">0</span>]);</span><br><span class="line">    w[<span class="number">1</span>] = <span class="built_in">huber</span>(sqrt_w_ray * err[<span class="number">1</span>]);</span><br><span class="line">    w[<span class="number">2</span>] = <span class="built_in">huber</span>(sqrt_w_ray * err[<span class="number">2</span>]);</span><br><span class="line">    w[<span class="number">3</span>] = <span class="built_in">huber</span>(sqrt_w_dist * err[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add back in sigma</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> w_const_ray = sqrt_w_ray * sqrt_w_ray;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> w_const_dist = sqrt_w_dist * sqrt_w_dist;</span><br><span class="line">    w[<span class="number">0</span>] *= w_const_ray;</span><br><span class="line">    w[<span class="number">1</span>] *= w_const_ray;</span><br><span class="line">    w[<span class="number">2</span>] *= w_const_ray;</span><br><span class="line">    w[<span class="number">3</span>] *= w_const_dist;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Jacobians</span></span><br><span class="line">    ...</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有标定参数</span></span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">calib_proj_kernel</span><span class="params">(...)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="built_in">GPU_1D_KERNEL_LOOP</span>(k, num_points) {</span><br><span class="line">    <span class="comment">// Transform point</span></span><br><span class="line">    <span class="built_in">actSim3</span>(tij, qij, sij, Xj, Xj_Ci);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if in front of camera</span></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> valid_z = ((Xj_Ci[<span class="number">2</span>] &gt; z_eps) &amp;&amp; (Xi[<span class="number">2</span>] &gt; z_eps));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle depth related vars</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> zj_inv = valid_z ? <span class="number">1.0</span>/Xj_Ci[<span class="number">2</span>] : <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> zj_log = valid_z ? <span class="built_in">logf</span>(Xj_Ci[<span class="number">2</span>]) : <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> zi_log = valid_z ? <span class="built_in">logf</span>(Xi[<span class="number">2</span>]) : <span class="number">0.0</span>; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Project point</span></span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> x_div_z = Xj_Ci[<span class="number">0</span>] * zj_inv;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> y_div_z = Xj_Ci[<span class="number">1</span>] * zj_inv;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> u = fx * x_div_z + cx;</span><br><span class="line">    <span class="type">const</span> <span class="type">float</span> v = fy * y_div_z + cy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle proj</span></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> valid_u = ((u &gt; pixel_border) &amp;&amp; (u &lt; width - <span class="number">1</span> - pixel_border));</span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> valid_v = ((v &gt; pixel_border) &amp;&amp; (v &lt; height - <span class="number">1</span> - pixel_border));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Error (difference in camera rays)</span></span><br><span class="line">    <span class="comment">// 优化目标：重投影误差+对数深度误差</span></span><br><span class="line">    err[<span class="number">0</span>] = u - u_target;</span><br><span class="line">    err[<span class="number">1</span>] = v - v_target;</span><br><span class="line">    err[<span class="number">2</span>] = zj_log - zi_log; <span class="comment">// Log-depth</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后面加权和jacobian省略</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h2 id="vggt-slam">VGGT-SLAM</h2>
<p>VGGT本身也是重建算法，并且它更加直接干脆，像MAST3R只能输出点图和特征图，仍然需要后续匹配和优化求解；而VGGT由于本身可以通过Camera Head和DPT来输出位姿和深度图、点图，因此基于VGGT构建的SLAM系统在代码层面就更加简洁了。并且由于VGGT的性质，它利用AA来一次处理一批图像，所以在构架SLAM的架构时也有所不同。</p>
<p>同样的，我们后面从VGGT-SLAM的数据结构开始，然后再详细介绍其系统架构与流程，当然，也要着重介绍一下为什么会使用SL(4)取代Sim(3)。</p>
<h3 id="graphmap与submap">GraphMap与Submap</h3>
<p>GraphMap和Submap两个类总体上还是比较简单的，GraphMap类只是提供了对于Submap管理的接口，主要用于获取子地图以及子地图中的帧以及优化后更新子地图位姿，就不贴代码了。而Submap存储了每个子地图与世界坐标系的转换，以及当前子地图中的所有帧和VGGT估计出来的点图、内参矩阵，当然还有用于回环检测的向量。</p>
<p>因为VGGT支持一次输入多张图像进行重建，所以在VGGT-SLAM里的最小重建单元就是子地图，每次累计一批图像然后，然后保证前后两个子地图之间有一部分重叠，并把回环帧也一块扔到VGGT里得到结果，再根据重叠帧来计算两个子地图的相对变换从而获取到每帧在空间中的位置，这部分的处理还是相对比较粗暴的。</p>
<img src="/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/vggt_submap.png" class="">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Submap</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, submap_id</span>):</span><br><span class="line">        self.submap_id = submap_id</span><br><span class="line">        self.frame_ids = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># 在送入VGGT时，会按照[正常帧1, ...正常帧n, 回环1, 回环2...]这样组织，last_non_loop_frame_index用于标记正常帧与回环帧之间的分割</span></span><br><span class="line">        self.last_non_loop_frame_index = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 这是一些VGGT估计出来的数据，以及当前子地图对于world坐标系之间转换</span></span><br><span class="line">        self.frames = <span class="literal">None</span></span><br><span class="line">        self.H_world_map = <span class="literal">None</span></span><br><span class="line">        self.poses = <span class="literal">None</span></span><br><span class="line">        self.vggt_intrinscs = <span class="literal">None</span></span><br><span class="line">        self.pointclouds = <span class="literal">None</span> <span class="comment"># (S, H, W, 3)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># retrieval_vectors用于回环检测</span></span><br><span class="line">        self.retrieval_vectors = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 其他一些筛选或者绘图的东西</span></span><br><span class="line">        self.conf = <span class="literal">None</span> <span class="comment"># (S, H, W)</span></span><br><span class="line">        self.conf_masks = <span class="literal">None</span> <span class="comment"># (S, H, W)</span></span><br><span class="line">        self.conf_threshold = <span class="literal">None</span></span><br><span class="line">        self.colors = <span class="literal">None</span> <span class="comment"># (S, H, W, 3)</span></span><br></pre></td></tr></table></figure>
<h3 id="sl4与sim3的子地图配准">SL(4)与Sim(3)的子地图配准</h3>
<h4 id="射影重构定理">射影重构定理</h4>
<p>在详细讲这部分内容之前我们先来看一下射影重构定理。</p>
<p><strong>射影重构定理：如果两幅视图的一个点对应集唯一的确定了基本矩阵，则景物和摄像机可以仅由这些对应重构，而且由这些对应产生的任何两个重构都是射影等价的。</strong></p>
<p>这句话非常的拗口，但它的意思其实很简单，就是说如果我们有两张图像，并且通过匹配点计算出了它们之间的基本矩阵（即不知道相机的内参），我们此时虽然可以恢复出场景的3D点和相机的位姿，但这个恢复出来的结果并不是唯一的，并且恢复出来的空间场景可能与真实场景非常不同，但它们在这两幅图像下的投影结果是一样的，并且这些不同的场景之间仅仅相差一个射影变换。换句话说，在不知道内参的情况下，我们只能通过两幅图像来恢复出一个射影等价的重建结果，如下图右侧所示；如果知道相机内参那么就是使用本质矩阵进行重建，那么重建结果与真实结果之间仅仅相差一个相似变换，如下图左侧所示。</p>
<img src="/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/reconstruction_ambiguity.png" class="">
<div class="note info">
            <p><strong>为什么在相机内参未知的时候重建会出现射影多义性呢</strong></p><p>这部分严格的数学证明可以参考《Multiple View Geometry in Computer Vision》第9章和第十章，写的非常清楚了。下面说一下个人的几个直观的角度的理解。</p><ul><li>从直观意义角度来看。未标定相机丢失了内部尺度、正交、比例等度量信息，所以只能通过匹配只恢复了射影结构。射影变换又仅仅保留了“穿过相机中心的直线投影到图像”的对应关系，所以任何全局射影变形都没办法被计算出来。</li><li>从射影空间角度来看。标定相机的内参实质上就是标定绝对二次曲线的像(或者叫IAC，<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.407ex" height="1.027ex" role="img" focusable="false" viewBox="0 -443 622 454"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D714" d="M495 384Q495 406 514 424T555 443Q574 443 589 425T604 364Q604 334 592 278T555 155T483 38T377 -11Q297 -11 267 66Q266 68 260 61Q201 -11 125 -11Q15 -11 15 139Q15 230 56 325T123 434Q135 441 147 436Q160 429 160 418Q160 406 140 379T94 306T62 208Q61 202 61 187Q61 124 85 100T143 76Q201 76 245 129L253 137V156Q258 297 317 297Q348 297 348 261Q348 243 338 213T318 158L308 135Q309 133 310 129T318 115T334 97T358 83T393 76Q456 76 501 148T546 274Q546 305 533 325T508 357T495 384Z"></path></g></g></g></svg></mjx-container></span>)，其为由纯虚点构成图像上不可见，方程满足<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="13.473ex" height="1.929ex" role="img" focusable="false" viewBox="0 -841.7 5955.2 852.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D714" d="M495 384Q495 406 514 424T555 443Q574 443 589 425T604 364Q604 334 592 278T555 155T483 38T377 -11Q297 -11 267 66Q266 68 260 61Q201 -11 125 -11Q15 -11 15 139Q15 230 56 325T123 434Q135 441 147 436Q160 429 160 418Q160 406 140 379T94 306T62 208Q61 202 61 187Q61 124 85 100T143 76Q201 76 245 129L253 137V156Q258 297 317 297Q348 297 348 261Q348 243 338 213T318 158L308 135Q309 133 310 129T318 115T334 97T358 83T393 76Q456 76 501 148T546 274Q546 305 533 325T508 357T495 384Z"></path></g><g data-mml-node="mo" transform="translate(899.8,0)"><path data-c="221D" d="M56 124T56 216T107 375T238 442Q260 442 280 438T319 425T352 407T382 385T406 361T427 336T442 315T455 297T462 285L469 297Q555 442 679 442Q687 442 722 437V398H718Q710 400 694 400Q657 400 623 383T567 343T527 294T503 253T495 235Q495 231 520 192T554 143Q625 44 696 44Q717 44 719 46H722V-5Q695 -11 678 -11Q552 -11 457 141Q455 145 454 146L447 134Q362 -11 235 -11Q157 -11 107 56ZM93 213Q93 143 126 87T220 31Q258 31 292 48T349 88T389 137T413 178T421 196Q421 200 396 239T362 288Q322 345 288 366T213 387Q163 387 128 337T93 213Z"></path></g><g data-mml-node="msup" transform="translate(1955.6,0)"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="TeXAtom" transform="translate(974,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g><g data-mml-node="msup" transform="translate(4027.5,0)"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="TeXAtom" transform="translate(974,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></g></svg></mjx-container></span>。因此未标定相机实质就是IAC以及无穷远平面均不确定；而相似变换没有改变绝对二次曲线(表现为球仍然是球)，仿射变换没有改变无穷远平面(表现为平行线仍然是平行线)。因此，未标定相机的重建会出现射影多义性，而已标定相机的重建会出现相似变换多义性。</li></ul>
          </div>
<h4 id="特殊线性群sln群与射影特殊线性群psln">特殊线性群SL(n)群与射影特殊线性群PSL(n)</h4>
<p>SL(n)即特殊线性群，跟一般线性群GL(n)的区别在于其行列式恒为1(类似正交群O(n)和特殊正交群SO(n)的关系，特殊指的就是行列式为1)。而我们也同样知道，射影变换对应的矩阵也满足行列式为1，因此射影变换矩阵属于SL(n)群。而由于射影变换矩阵存在一个比例因子的歧义性，因此我们通常使用PSL(n)来表示射影变换群，PSL(n)即为SL(n)群除以其中心Z(SL(n))，也就是所有比例因子构成的群。</p>
<p>换句话说，SL(n)可以诱导一个PSL(n)，但PSL(n)可以对应多个SL(n)，这是因为射影变换作用在齐次坐标上，而齐次坐标本身就存在比例因子的歧义性。</p>
<p>举个例子，以在三维空间为例，射影变换可以表示为一个4x4的矩阵作用在齐次坐标上：</p>
<p><span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -5.347ex;" xmlns="http://www.w3.org/2000/svg" width="37.632ex" height="11.826ex" role="img" focusable="false" viewBox="0 -2863.5 16633.6 5226.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mn" transform="translate(466.7,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="msup" transform="translate(220,-686)"><g data-mml-node="mi"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path></g><g data-mml-node="mo" transform="translate(749,289) scale(0.707)"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"></path></g></g><rect width="1193.5" height="60" x="120" y="220"></rect></g><g data-mml-node="mrow" transform="translate(1433.5,0)"><g data-mml-node="mo"><path data-c="23A1" d="M319 -645V1154H666V1070H403V-645H319Z" transform="translate(0,1709.5)"></path><path data-c="23A3" d="M319 -644V1155H403V-560H666V-644H319Z" transform="translate(0,-1719.5)"></path><svg width="667" height="1828.9" y="-664.5" x="0" viewBox="0 457.2 667 1828.9"><path data-c="23A2" d="M319 0V602H403V0H319Z" transform="scale(1,4.557)"></path></svg></g><g data-mml-node="mtable" transform="translate(667,0)"><g data-mml-node="mtr" transform="translate(0,2104.5)"><g data-mml-node="mtd"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(605,363) scale(0.707)"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"></path></g></g></g></g><g data-mml-node="mtr" transform="translate(0,695.5)"><g data-mml-node="mtd" transform="translate(41,0)"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(523,363) scale(0.707)"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"></path></g></g></g></g><g data-mml-node="mtr" transform="translate(0,-713.5)"><g data-mml-node="mtd" transform="translate(53.5,0)"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="mo" transform="translate(498,363) scale(0.707)"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"></path></g></g></g></g><g data-mml-node="mtr" transform="translate(0,-2113.5)"><g data-mml-node="mtd" transform="translate(174.7,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(1516.5,0)"><path data-c="23A4" d="M0 1070V1154H347V-645H263V1070H0Z" transform="translate(0,1709.5)"></path><path data-c="23A6" d="M263 -560V1155H347V-644H0V-560H263Z" transform="translate(0,-1719.5)"></path><svg width="667" height="1828.9" y="-664.5" x="0" viewBox="0 457.2 667 1828.9"><path data-c="23A5" d="M263 0V602H347V0H263Z" transform="scale(1,4.557)"></path></svg></g></g><g data-mml-node="mo" transform="translate(3894.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mrow" transform="translate(4950.5,0)"><g data-mml-node="mo"><path data-c="23A1" d="M319 -645V1154H666V1070H403V-645H319Z" transform="translate(0,1696)"></path><path data-c="23A3" d="M319 -644V1155H403V-560H666V-644H319Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A2" d="M319 0V602H403V0H319Z" transform="scale(1,4.49)"></path></svg></g><g data-mml-node="mtable" transform="translate(667,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(2319.1,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(4638.2,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(6957.3,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500,0)"></path></g></g></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(2319.1,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(4638.2,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(6957.3,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500,0)"></path></g></g></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(2319.1,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(4638.2,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(6957.3,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500,0)"></path></g></g></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(2319.1,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(4638.2,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mtd" transform="translate(6957.3,0)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="TeXAtom" transform="translate(562,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500,0)"></path></g></g></g></g></g></g><g data-mml-node="mo" transform="translate(8943.4,0)"><path data-c="23A4" d="M0 1070V1154H347V-645H263V1070H0Z" transform="translate(0,1696)"></path><path data-c="23A6" d="M263 -560V1155H347V-644H0V-560H263Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A5" d="M263 0V602H347V0H263Z" transform="scale(1,4.49)"></path></svg></g></g><g data-mml-node="mrow" transform="translate(14727.6,0)"><g data-mml-node="mo"><path data-c="23A1" d="M319 -645V1154H666V1070H403V-645H319Z" transform="translate(0,1696)"></path><path data-c="23A3" d="M319 -644V1155H403V-560H666V-644H319Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A2" d="M319 0V602H403V0H319Z" transform="scale(1,4.49)"></path></svg></g><g data-mml-node="mtable" transform="translate(667,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd" transform="translate(41,0)"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd" transform="translate(53.5,0)"><g data-mml-node="mi"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd" transform="translate(36,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(1239,0)"><path data-c="23A4" d="M0 1070V1154H347V-645H263V1070H0Z" transform="translate(0,1696)"></path><path data-c="23A6" d="M263 -560V1155H347V-644H0V-560H263Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A5" d="M263 0V602H347V0H263Z" transform="scale(1,4.49)"></path></svg></g></g></g></g></svg></mjx-container></span></p>
<p>如果取射影变换<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="6.166ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 2725.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43B" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g><g data-mml-node="mo" transform="translate(1165.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(2221.6,0)"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g></g></g></svg></mjx-container></span>，那么变换后的坐标仍然是<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.039ex" height="2.47ex" role="img" focusable="false" viewBox="0 -841.7 3553.1 1091.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mi" transform="translate(278,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(850,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(1294.7,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(1784.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(2229.3,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="msup" transform="translate(2694.3,0)"><g data-mml-node="mo"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g><g data-mml-node="mi" transform="translate(311,363) scale(0.707)"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g></g></svg></mjx-container></span>:</p>
<p><span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -5.317ex;" xmlns="http://www.w3.org/2000/svg" width="26.349ex" height="11.765ex" role="img" focusable="false" viewBox="0 -2850 11646.2 5200"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><path data-c="23A1" d="M319 -645V1154H666V1070H403V-645H319Z" transform="translate(0,1696)"></path><path data-c="23A3" d="M319 -644V1155H403V-560H666V-644H319Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A2" d="M319 0V602H403V0H319Z" transform="scale(1,4.49)"></path></svg></g><g data-mml-node="mtable" transform="translate(667,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd" transform="translate(41,0)"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd" transform="translate(53.5,0)"><g data-mml-node="mi"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd" transform="translate(36,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(1239,0)"><path data-c="23A4" d="M0 1070V1154H347V-645H263V1070H0Z" transform="translate(0,1696)"></path><path data-c="23A6" d="M263 -560V1155H347V-644H0V-560H263Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A5" d="M263 0V602H347V0H263Z" transform="scale(1,4.49)"></path></svg></g></g><g data-mml-node="mo" transform="translate(2183.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mrow" transform="translate(3239.6,0)"><g data-mml-node="mo"><path data-c="23A1" d="M319 -645V1154H666V1070H403V-645H319Z" transform="translate(0,1696)"></path><path data-c="23A3" d="M319 -644V1155H403V-560H666V-644H319Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A2" d="M319 0V602H403V0H319Z" transform="scale(1,4.49)"></path></svg></g><g data-mml-node="mtable" transform="translate(667,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(5667,0)"><path data-c="23A4" d="M0 1070V1154H347V-645H263V1070H0Z" transform="translate(0,1696)"></path><path data-c="23A6" d="M263 -560V1155H347V-644H0V-560H263Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A5" d="M263 0V602H347V0H263Z" transform="scale(1,4.49)"></path></svg></g></g><g data-mml-node="mrow" transform="translate(9740.2,0)"><g data-mml-node="mo"><path data-c="23A1" d="M319 -645V1154H666V1070H403V-645H319Z" transform="translate(0,1696)"></path><path data-c="23A3" d="M319 -644V1155H403V-560H666V-644H319Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A2" d="M319 0V602H403V0H319Z" transform="scale(1,4.49)"></path></svg></g><g data-mml-node="mtable" transform="translate(667,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd" transform="translate(41,0)"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd" transform="translate(53.5,0)"><g data-mml-node="mi"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd" transform="translate(36,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(1239,0)"><path data-c="23A4" d="M0 1070V1154H347V-645H263V1070H0Z" transform="translate(0,1696)"></path><path data-c="23A6" d="M263 -560V1155H347V-644H0V-560H263Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A5" d="M263 0V602H347V0H263Z" transform="scale(1,4.49)"></path></svg></g></g></g></g></svg></mjx-container></span></p>
<p>而如果取<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="7.927ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 3503.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D43B" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g><g data-mml-node="mo" transform="translate(1165.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(2221.6,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2999.6,0)"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g></g></g></svg></mjx-container></span>，变换后为<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.912ex;" xmlns="http://www.w3.org/2000/svg" width="13.819ex" height="2.942ex" role="img" focusable="false" viewBox="0 -897.2 6108.1 1300.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mfrac" transform="translate(278,0)"><g data-mml-node="mrow" transform="translate(220,398) scale(0.707)"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g><g data-mml-node="mrow" transform="translate(245.5,-345) scale(0.707)"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><rect width="1154.6" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1672.6,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mfrac" transform="translate(2117.3,0)"><g data-mml-node="mrow" transform="translate(223.5,485) scale(0.707)"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><rect width="1103.7" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(3460.9,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mfrac" transform="translate(3905.6,0)"><g data-mml-node="mrow" transform="translate(232.4,398) scale(0.707)"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><rect width="1103.7" height="60" x="120" y="220"></rect></g><g data-mml-node="msup" transform="translate(5249.3,0)"><g data-mml-node="mo"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g><g data-mml-node="mi" transform="translate(311,363) scale(0.707)"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g></g></svg></mjx-container></span>，仍然表示<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="8.039ex" height="2.47ex" role="img" focusable="false" viewBox="0 -841.7 3553.1 1091.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mi" transform="translate(278,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(850,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(1294.7,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(1784.7,0)"><path data-c="2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path></g><g data-mml-node="mi" transform="translate(2229.3,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g><g data-mml-node="msup" transform="translate(2694.3,0)"><g data-mml-node="mo"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g><g data-mml-node="mi" transform="translate(311,363) scale(0.707)"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g></g></svg></mjx-container></span>：</p>
<p><span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -5.317ex;" xmlns="http://www.w3.org/2000/svg" width="30.246ex" height="11.765ex" role="img" focusable="false" viewBox="0 -2850 13368.9 5200"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><path data-c="23A1" d="M319 -645V1154H666V1070H403V-645H319Z" transform="translate(0,1696)"></path><path data-c="23A3" d="M319 -644V1155H403V-560H666V-644H319Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A2" d="M319 0V602H403V0H319Z" transform="scale(1,4.49)"></path></svg></g><g data-mml-node="mtable" transform="translate(667,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd" transform="translate(41,0)"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd" transform="translate(53.5,0)"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd" transform="translate(36,0)"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(2017,0)"><path data-c="23A4" d="M0 1070V1154H347V-645H263V1070H0Z" transform="translate(0,1696)"></path><path data-c="23A6" d="M263 -560V1155H347V-644H0V-560H263Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A5" d="M263 0V602H347V0H263Z" transform="scale(1,4.49)"></path></svg></g></g><g data-mml-node="mo" transform="translate(2961.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(4017.6,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mrow" transform="translate(4962.2,0)"><g data-mml-node="mo"><path data-c="23A1" d="M319 -645V1154H666V1070H403V-645H319Z" transform="translate(0,1696)"></path><path data-c="23A3" d="M319 -644V1155H403V-560H666V-644H319Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A2" d="M319 0V602H403V0H319Z" transform="scale(1,4.49)"></path></svg></g><g data-mml-node="mtable" transform="translate(667,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(5667,0)"><path data-c="23A4" d="M0 1070V1154H347V-645H263V1070H0Z" transform="translate(0,1696)"></path><path data-c="23A6" d="M263 -560V1155H347V-644H0V-560H263Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A5" d="M263 0V602H347V0H263Z" transform="scale(1,4.49)"></path></svg></g></g><g data-mml-node="mrow" transform="translate(11462.9,0)"><g data-mml-node="mo"><path data-c="23A1" d="M319 -645V1154H666V1070H403V-645H319Z" transform="translate(0,1696)"></path><path data-c="23A3" d="M319 -644V1155H403V-560H666V-644H319Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A2" d="M319 0V602H403V0H319Z" transform="scale(1,4.49)"></path></svg></g><g data-mml-node="mtable" transform="translate(667,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd" transform="translate(41,0)"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd" transform="translate(53.5,0)"><g data-mml-node="mi"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd" transform="translate(36,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(1239,0)"><path data-c="23A4" d="M0 1070V1154H347V-645H263V1070H0Z" transform="translate(0,1696)"></path><path data-c="23A6" d="M263 -560V1155H347V-644H0V-560H263Z" transform="translate(0,-1706)"></path><svg width="667" height="1802" y="-651" x="0" viewBox="0 450.5 667 1802"><path data-c="23A5" d="M263 0V602H347V0H263Z" transform="scale(1,4.49)"></path></svg></g></g></g></g></svg></mjx-container></span></p>
<h4 id="vggt-slam中的优化">VGGT-SLAM中的优化</h4>
<p>SL(4)与PSL(4)的关系非常像单位四元数SU(2)和特殊正交群SO(3)的关系，即<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="1.041ex" height="1.439ex" role="img" focusable="false" viewBox="0 -442 460 636"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g></svg></mjx-container></span>和<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="2.801ex" height="1.758ex" role="img" focusable="false" viewBox="0 -583 1238 777"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g></svg></mjx-container></span>对应了同一个旋转<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.048ex;" xmlns="http://www.w3.org/2000/svg" width="1.717ex" height="1.593ex" role="img" focusable="false" viewBox="0 -683 759 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path></g></g></g></svg></mjx-container></span>。也正是这个原因导致我们一般不会直接优化更新四元数，而是基于SO(3)的李代数<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="5ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2210 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D530" d="M272 33Q284 33 290 70T296 138Q296 181 290 198T262 230Q257 232 246 232Q231 232 218 227T156 194L108 167L101 176Q90 192 75 219L69 230V284Q69 346 70 357V377L146 427Q181 450 202 464T223 477L225 476Q227 475 229 474Q231 472 242 466T270 450T296 431Q309 418 326 418Q342 418 361 429T392 450T403 459Q406 445 406 442Q406 440 384 421T338 382L316 363Q315 362 310 362Q292 362 251 371T173 396Q156 403 155 403Q143 386 143 342Q143 305 150 278T168 244Q171 242 181 242L190 243L315 300Q330 295 357 274Q358 273 362 270T366 266T369 261T372 253T373 239T374 217T374 185Q374 157 372 133T368 98T363 71T358 50L336 40Q288 20 255 2T211 -22T198 -29L190 -22Q181 -14 168 -3T138 19T104 38T70 46Q50 46 32 37T3 20T-9 11L-18 23L-1 41Q46 89 62 99T112 110Q141 110 157 103T225 62Q268 33 272 33Z"></path><path data-c="1D52C" d="M67 121Q70 265 84 359V364L97 371Q137 394 177 421T238 464T260 480L278 468Q295 457 327 442T394 418L406 414Q412 388 412 300Q412 263 410 228T405 170T399 130T393 103T391 92L381 86Q274 19 165 -28L161 -24Q157 -21 151 -15T136 -2T118 14T101 30T86 46T74 60L67 68V121ZM335 278Q335 286 335 303T334 335L333 349V356H326Q288 360 208 388L183 397Q178 393 172 383T154 333T142 239Q142 192 151 134Q152 124 155 120T175 99Q197 77 219 64T251 47T267 44T281 52T302 80T320 124Q335 182 335 278Z" transform="translate(443,0)"></path></g></g><g data-mml-node="mo" transform="translate(932,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(1321,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(1821,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>来进行优化更新。</p>
<p>同样的，VGGT-SLAM中也是基于SL(4)的李代数<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="4.527ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 2001 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D530" d="M272 33Q284 33 290 70T296 138Q296 181 290 198T262 230Q257 232 246 232Q231 232 218 227T156 194L108 167L101 176Q90 192 75 219L69 230V284Q69 346 70 357V377L146 427Q181 450 202 464T223 477L225 476Q227 475 229 474Q231 472 242 466T270 450T296 431Q309 418 326 418Q342 418 361 429T392 450T403 459Q406 445 406 442Q406 440 384 421T338 382L316 363Q315 362 310 362Q292 362 251 371T173 396Q156 403 155 403Q143 386 143 342Q143 305 150 278T168 244Q171 242 181 242L190 243L315 300Q330 295 357 274Q358 273 362 270T366 266T369 261T372 253T373 239T374 217T374 185Q374 157 372 133T368 98T363 71T358 50L336 40Q288 20 255 2T211 -22T198 -29L190 -22Q181 -14 168 -3T138 19T104 38T70 46Q50 46 32 37T3 20T-9 11L-18 23L-1 41Q46 89 62 99T112 110Q141 110 157 103T225 62Q268 33 272 33Z"></path><path data-c="1D529" d="M221 76L267 99Q268 98 269 96T271 88T270 82L262 76Q255 69 241 57T214 34L148 -20L98 56L99 89Q107 247 107 373Q107 494 101 621Q101 653 99 659V665L106 668L113 672L118 655Q122 642 131 617L138 597Q140 597 157 611L240 670L264 685Q265 685 270 680T276 674T269 667T247 647T219 617Q197 587 186 551T173 493T171 438Q171 376 175 282T179 147V117Q184 109 201 93T221 76Z" transform="translate(443,0)"></path></g></g><g data-mml-node="mo" transform="translate(723,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(1112,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(1612,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>来进行优化更新的，值得一提的是，SL(4)和PSL(4)的李代数是一样的，因此我们可以直接在SL(4)上进行优化，而不需要考虑比例因子的歧义性问题。</p>
<p>作者是为GTSAM补充了一个SL(4)的模块，有兴趣的话可以参考作者给出的实现，这里就不再赘述了。</p>
<h3 id="vggt-slam重建与回环">VGGT-SLAM重建与回环</h3>
<p>VGGT-SLAM直接利用了VGGT的API，没有对图像做更多的处理了。还有一点，VGGT-SLAM在完成点图计算后也没有进行匹配的流程，因为重叠帧的位置是严格确定的，只需要取出对应位置的两帧用RANSAC晒掉坏点就可以了。</p>
<p>而VGGT-SLAM的整体流程可以说是非常简单：到达若干张图像后，将上一个子地图最后几张放在现在图像的前面；再使用SALAD模型全局搜索一下回环帧，把回环帧放在现在图像后面；这样组成一个图像集合直接送给VGGT来进行预测。VGGT会给出子地图中每一帧的相对位姿，因此只需要在重叠帧和回环帧上计算出当前子地图对于上一子地图和回环子地图之间的相对变换，就能构建一个Pose Graph来进行优化（没错，VGGT-SLAM只有Pose Graph级别的优化，完全不涉及任何地图点的BA）。这部分内容实在没什么好说的，直接看看代码吧。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主函数的流程</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">for</span> image_name <span class="keyword">in</span> tqdm(image_names):</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">len</span>(image_names_subset) == args.submap_size + args.overlapping_window_sizeor image_name == image_names[-<span class="number">1</span>]):</span><br><span class="line">            <span class="comment"># 构建子地图帧集合然后执行推断</span></span><br><span class="line">            predictions = solver.run_predictions(image_names_subset, model, args.max_loops)</span><br><span class="line">            <span class="comment"># 基于重叠帧和回环帧计算相对变换。同时为Pose Graph添加边</span></span><br><span class="line">            solver.add_points(predictions)</span><br><span class="line">            <span class="comment"># 执行优化并更新子地图中的变换H</span></span><br><span class="line">            solver.graph.optimize()</span><br><span class="line">            solver.<span class="built_in">map</span>.update_submap_homographies(solver.graph)</span><br><span class="line">            <span class="comment"># 把当前子地图最后几帧添加到下一子地图的最前面</span></span><br><span class="line">            image_names_subset = image_names_subset[-args.overlapping_window_size :]</span><br></pre></td></tr></table></figure>
<p>主要的函数就上面列出的这几个，而这几个函数内部对比其他的SLAM系统也可以说是非常简单了。由于位姿估计是VGGT的API，而又不需要执行匹配操作，所以主要代码就集中在<code>add_points()</code>里。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solver</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run_predictions</span>(<span class="params">self, image_names, model, max_loops</span>):</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment"># 计算submap的特征向量</span></span><br><span class="line">        new_submap.set_all_retrieval_vectors(self.image_retrieval.get_all_submap_embeddings(new_submap))</span><br><span class="line">        <span class="comment"># 然后基于此特征来找回环帧</span></span><br><span class="line">        detected_loops = self.image_retrieval.find_loop_closures(self.<span class="built_in">map</span>, new_submap, max_loop_closures=max_loops)</span><br><span class="line">        retrieved_frames = self.<span class="built_in">map</span>.get_frames_from_loops(detected_loops)</span><br><span class="line"></span><br><span class="line">        num_loop_frames = <span class="built_in">len</span>(retrieved_frames)</span><br><span class="line">        new_submap.set_last_non_loop_frame_index(images.shape[<span class="number">0</span>] - <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># 把回环添加到当前image set最后</span></span><br><span class="line">        <span class="keyword">if</span> num_loop_frames &gt; <span class="number">0</span>:</span><br><span class="line">            image_tensor = torch.stack(retrieved_frames)  <span class="comment"># Shape (n, 3, w, h)</span></span><br><span class="line">            images = torch.cat([images, image_tensor], dim=<span class="number">0</span>) <span class="comment"># Shape (s+n, 3, w, h)</span></span><br><span class="line">            new_submap.add_all_frames(images)</span><br><span class="line"></span><br><span class="line">        self.current_working_submap = new_submap</span><br><span class="line">        <span class="comment"># 然后执行推断并返回</span></span><br><span class="line">        <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">            <span class="keyword">with</span> torch.cuda.amp.autocast(dtype=dtype):</span><br><span class="line">                predictions = model(images)</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> predictions</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_points</span>(<span class="params">self, pred_dict</span>):</span><br><span class="line">        <span class="comment"># 可以选择使用点图或者是深度图来重建</span></span><br><span class="line">        <span class="keyword">if</span> self.use_point_map:</span><br><span class="line">            world_points_map = pred_dict[<span class="string">"world_points"</span>]</span><br><span class="line">            conf = pred_dict[<span class="string">"world_points_conf"</span>]</span><br><span class="line">            world_points = world_points_map</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            depth_map = pred_dict[<span class="string">"depth"</span>]</span><br><span class="line">            conf = pred_dict[<span class="string">"depth_conf"</span>]</span><br><span class="line">            world_points = unproject_depth_map_to_point_map(depth_map, extrinsics_cam, intrinsics_cam)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Flatten</span></span><br><span class="line">        cam_to_world = closed_form_inverse_se3(extrinsics_cam)  <span class="comment"># shape (S, 4, 4)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># estimate focal length from points</span></span><br><span class="line">        points_in_first_cam = world_points[<span class="number">0</span>,...]</span><br><span class="line">        h, w = points_in_first_cam.shape[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">        new_pcd_num = self.current_working_submap.get_id()</span><br><span class="line">        <span class="keyword">if</span> self.first_edge:</span><br><span class="line">            <span class="comment"># 第一个子地图不执行求解</span></span><br><span class="line">            self.first_edge = <span class="literal">False</span></span><br><span class="line">            self.prior_pcd = world_points[-<span class="number">1</span>,...].reshape(-<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">            self.prior_conf = conf[-<span class="number">1</span>,...].reshape(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            H_w_submap = np.eye(<span class="number">4</span>)</span><br><span class="line">            self.graph.add_homography(new_pcd_num, H_w_submap)</span><br><span class="line">            self.graph.add_prior_factor(new_pcd_num, H_w_submap, self.graph.anchor_noise)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prior_pcd_num = self.<span class="built_in">map</span>.get_largest_key()</span><br><span class="line">            prior_submap = self.<span class="built_in">map</span>.get_submap(prior_pcd_num)</span><br><span class="line">            current_pts = world_points[<span class="number">0</span>,...].reshape(-<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">            good_mask = self.prior_conf &gt; prior_submap.get_conf_threshold() * (conf[<span class="number">0</span>,...,:].reshape(-<span class="number">1</span>) &gt; prior_submap.get_conf_threshold())</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># sim3 求解是直接计算出尺度然后用上一帧R|t作为当前帧变换，因为后续还会解Pose Graph，相当于初值了</span></span><br><span class="line">            <span class="keyword">if</span> self.use_sim3:</span><br><span class="line">                R_temp = prior_submap.poses[prior_submap.get_last_non_loop_frame_index()][<span class="number">0</span>:<span class="number">3</span>,<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">                t_temp = prior_submap.poses[prior_submap.get_last_non_loop_frame_index()][<span class="number">0</span>:<span class="number">3</span>,<span class="number">3</span>]</span><br><span class="line">                T_temp = np.eye(<span class="number">4</span>)</span><br><span class="line">                T_temp[<span class="number">0</span>:<span class="number">3</span>,<span class="number">0</span>:<span class="number">3</span>] = R_temp</span><br><span class="line">                T_temp[<span class="number">0</span>:<span class="number">3</span>,<span class="number">3</span>] = t_temp</span><br><span class="line">                T_temp = np.linalg.inv(T_temp)</span><br><span class="line">                scale_factor = np.mean(np.linalg.norm((T_temp[<span class="number">0</span>:<span class="number">3</span>,<span class="number">0</span>:<span class="number">3</span>] @ self.prior_pcd[good_mask].T).T + T_temp[<span class="number">0</span>:<span class="number">3</span>,<span class="number">3</span>], axis=<span class="number">1</span>) / np.linalg.norm(current_pts[good_mask], axis=<span class="number">1</span>))</span><br><span class="line">                H_relative = np.eye(<span class="number">4</span>)</span><br><span class="line">                H_relative[<span class="number">0</span>:<span class="number">3</span>,<span class="number">0</span>:<span class="number">3</span>] = R_temp</span><br><span class="line">                H_relative[<span class="number">0</span>:<span class="number">3</span>,<span class="number">3</span>] = t_temp</span><br><span class="line">                world_points *= scale_factor</span><br><span class="line">                cam_to_world[:, <span class="number">0</span>:<span class="number">3</span>, <span class="number">3</span>] *= scale_factor</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 对于SL4的求解则是基于RANSAC</span></span><br><span class="line">                H_relative = ransac_projective(current_pts[good_mask], self.prior_pcd[good_mask])</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 根据相对变换求解当前子地图对于world的变换关系</span></span><br><span class="line">            H_w_submap = prior_submap.get_reference_homography() @ H_relative</span><br><span class="line">            non_lc_frame = self.current_working_submap.get_last_non_loop_frame_index()</span><br><span class="line">            pts_cam0_camn = world_points[non_lc_frame,...].reshape(-<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">            self.prior_pcd = pts_cam0_camn</span><br><span class="line">            self.prior_conf = conf[non_lc_frame,...].reshape(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 将上一子地图与当前子地图作为边加入到优化中</span></span><br><span class="line">            self.graph.add_homography(new_pcd_num, H_w_submap)</span><br><span class="line">            self.graph.add_between_factor(prior_pcd_num, new_pcd_num, H_relative, self.graph.relative_noise)</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment"># 如果检测到了回环，那么同样也先求解相对位姿，然后构建边加入到图优化里</span></span><br><span class="line">        <span class="keyword">for</span> index, loop <span class="keyword">in</span> <span class="built_in">enumerate</span>(detected_loops):</span><br><span class="line">            loop_index = self.current_working_submap.get_last_non_loop_frame_index() + index + <span class="number">1</span></span><br><span class="line">            <span class="comment"># sim3和SL4的求解跟重叠帧类似</span></span><br><span class="line">            <span class="keyword">if</span> self.use_sim3:</span><br><span class="line">                pose_world_detected = self.<span class="built_in">map</span>.get_submap(loop.detected_submap_id).get_pose_subframe(loop.detected_submap_frame)</span><br><span class="line">                pose_world_query = self.current_working_submap.get_pose_subframe(loop_index)</span><br><span class="line">                pose_world_detected = gtsam.Pose3(pose_world_detected)</span><br><span class="line">                pose_world_query = gtsam.Pose3(pose_world_query)</span><br><span class="line">                H_relative_lc = pose_world_detected.between(pose_world_query).matrix()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                points_world_detected = self.<span class="built_in">map</span>.get_submap(loop.detected_submap_id).get_frame_pointcloud(loop.detected_submap_frame).reshape(-<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">                points_world_query = self.current_working_submap.get_frame_pointcloud(loop_index).reshape(-<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">                H_relative_lc = ransac_projective(points_world_query, points_world_detected)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            self.graph.add_between_factor(loop.detected_submap_id, loop.query_submap_id, H_relative_lc, self.graph.relative_noise)</span><br><span class="line">            self.graph.increment_loop_closure() <span class="comment"># Just for debugging and analysis, keep track of total number of loop closures</span></span><br><span class="line"></span><br><span class="line">        self.<span class="built_in">map</span>.add_submap(self.current_working_submap)</span><br></pre></td></tr></table></figure>
<p>而接下来会执行一次优化，但是VGGT-SLAM的优化只有Pose Graph优化，只会根据重叠帧和回环帧的约束来建立优化，而不会像MAST3R-SLAM那样基于ray夹角或者重投影误差来优化地图点，感觉VGGT-SLAM这样做有些粗糙了，同时也太相信VGGT的重建结果了。而回环的求解也很简单，使用SALAD描述符作为图像的回环特征，用L2距离来进行回环检测，这部分代码就懒得贴了。具体Pose Graph就如下图所示。</p>
<img src="/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/vggtslam_opt.png" class="">
<h3 id="总结">总结</h3>
<p>有一说一，VGGT-SLAM在工程上的处理实在是有些粗糙，让人读下去的欲望确实不是很大。另外，VGGT-SLAM提出SL(4)作为优化确实很有意思，但是从文中的指标来看，似乎并没有什么显著的提升...并且相机内参在SLAM中很容易获得，所以综合来看MAST3R-SLAM还是更胜一筹叭。</p>
<img src="/2025/05/24/VGGT-SLAM%E4%B8%8EMASt3R-SLAM%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/sl4-sim3.jpg" class="">
<p>而且这个指标感觉也是有水分的，因为代码中求解Sim3是直接依赖Pose Graph优化，而求解SL(4)则是基于RANSAC求解初值+Pose Graph优化。另外，关于作者提到的用Sim3做子地图配准的错位问题，但我觉得这并不能完全归咎于Sim3，因为作者在代码里并没有利用VGGT估计的内参做重投影误差的全局BA，而是完全依赖VGGT自身的输出结果，但是单目相机本来就丢失了自由度，完全依赖单目重建整个场景本身就具有奇异性。作者提到在对于稠密空间点做BA可能会非常耗时，但其实MAST3R已经提供了一个BA的范式：认为一个小区域内的像素相对深度是准确的，然后算一下这个小区域的平均深度来作为anchor，优化的时候只优化anchor并保持相对深度不变从而反推出区域内像素所有深度。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SLAM/" rel="tag"># SLAM</a>
              <a href="/tags/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" rel="tag"># 论文阅读</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/05/06/GPGN-%E9%AB%98%E6%96%AF%E8%BF%87%E7%A8%8B%E4%B8%8ESLAM%E5%90%8E%E7%AB%AF%E4%BC%98%E5%8C%96%E6%B1%82%E8%A7%A3/" rel="prev" title="GPGN-高斯过程与SLAM后端优化求解">
      <i class="fa fa-chevron-left"></i> GPGN-高斯过程与SLAM后端优化求解
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#mast3r-slam"><span class="nav-number">1.</span> <span class="nav-text">MASt3R-SLAM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#framesharedstates%E5%92%8Csharedkeyframes"><span class="nav-number">1.1.</span> <span class="nav-text">Frame、SharedStates和SharedKeyframes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mast3r%E6%8F%90%E5%8F%96%E7%89%B9%E5%BE%81%E4%B8%8E%E5%8C%B9%E9%85%8D"><span class="nav-number">1.2.</span> <span class="nav-text">MAST3R提取特征与匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%85%A5%E5%8F%A3%E4%B8%8Etracking"><span class="nav-number">1.3.</span> <span class="nav-text">系统入口与Tracking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D%E5%9B%9E%E7%8E%AF%E6%A3%80%E6%B5%8B%E4%B8%8Eoptimization"><span class="nav-number">1.4.</span> <span class="nav-text">重定位、回环检测与Optimization</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vggt-slam"><span class="nav-number">2.</span> <span class="nav-text">VGGT-SLAM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#graphmap%E4%B8%8Esubmap"><span class="nav-number">2.1.</span> <span class="nav-text">GraphMap与Submap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sl4%E4%B8%8Esim3%E7%9A%84%E5%AD%90%E5%9C%B0%E5%9B%BE%E9%85%8D%E5%87%86"><span class="nav-number">2.2.</span> <span class="nav-text">SL(4)与Sim(3)的子地图配准</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%84%E5%BD%B1%E9%87%8D%E6%9E%84%E5%AE%9A%E7%90%86"><span class="nav-number">2.2.1.</span> <span class="nav-text">射影重构定理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E7%BA%BF%E6%80%A7%E7%BE%A4sln%E7%BE%A4%E4%B8%8E%E5%B0%84%E5%BD%B1%E7%89%B9%E6%AE%8A%E7%BA%BF%E6%80%A7%E7%BE%A4psln"><span class="nav-number">2.2.2.</span> <span class="nav-text">特殊线性群SL(n)群与射影特殊线性群PSL(n)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vggt-slam%E4%B8%AD%E7%9A%84%E4%BC%98%E5%8C%96"><span class="nav-number">2.2.3.</span> <span class="nav-text">VGGT-SLAM中的优化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vggt-slam%E9%87%8D%E5%BB%BA%E4%B8%8E%E5%9B%9E%E7%8E%AF"><span class="nav-number">2.3.</span> <span class="nav-text">VGGT-SLAM重建与回环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.4.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Staskaer"
      src="/imgs/theme_pic/head_img.png">
  <p class="site-author-name" itemprop="name">Staskaer</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Staskaer" title="Github → https:&#x2F;&#x2F;github.com&#x2F;Staskaer" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:liujiaxin011121@gmail.com" title="E-Mail → mailto:liujiaxin011121@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/staskaer" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;staskaer" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Staskaer</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'xH8NDrh9u4SQrUpQOd0lICnX-MdYXbMMI',
      appKey     : 'jl3JjPS4jsosZG29Zv24Y7LE',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-Hans' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : 'https://xh8ndrh9.api.lncldglobal.com'
    });
  }, window.Valine);
});
</script>

</body>
</html>

